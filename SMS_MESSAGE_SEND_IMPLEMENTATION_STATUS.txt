================================================================================
ë©”ì‹œì§€ ë°œì†¡ ê¸°ëŠ¥ êµ¬í˜„ í˜„í™© - SMS/LMS/MMS
================================================================================
ìµœì¢… ì—…ë°ì´íŠ¸: 2025-10-13
ê¸°ì¤€ ë¬¸ì„œ: SMS_MESSAGE_SEND_IMPLEMENTATION_PLAN.txt
í”„ë¡œì íŠ¸: MTS Message (Next.js 15)

================================================================================
ëª©ì°¨
================================================================================
1. ì „ì²´ ì§„í–‰ë¥  ìš”ì•½
2. êµ¬í˜„ ì™„ë£Œ í•­ëª© (âœ…)
3. ë¯¸êµ¬í˜„ í•­ëª© ë° êµ¬í˜„ ë°©ë²• (âŒ)
4. ë‹¤ìŒ ë‹¨ê³„ ìš°ì„ ìˆœìœ„

================================================================================
1. ì „ì²´ ì§„í–‰ë¥  ìš”ì•½
================================================================================

Phase 1 (í•µì‹¬ ë°œì†¡ ê¸°ëŠ¥): 80% ì™„ë£Œ âœ…
Phase 2 (ê³ ê¸‰ ê¸°ëŠ¥): 20% ì™„ë£Œ âŒ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ êµ¬ë¶„                                 â”‚ ìƒíƒœ    â”‚ ë¹„ê³    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë°±ì—”ë“œ API (ê³µí†µ ë¡œì§)              â”‚ âœ… ì™„ë£Œ â”‚ 100%   â”‚
â”‚ ë©”ì‹œì§€ ë°œì†¡ API                     â”‚ âœ… ì™„ë£Œ â”‚ 100%   â”‚
â”‚ í”„ë¡ íŠ¸ì—”ë“œ ê¸°ë³¸ êµ¬ì¡°                â”‚ âœ… ì™„ë£Œ â”‚ 100%   â”‚
â”‚ ì¦‰ì‹œ ë°œì†¡ ê¸°ëŠ¥                      â”‚ âœ… ì™„ë£Œ â”‚ 100%   â”‚
â”‚ ì˜ˆì•½ ë°œì†¡ ê¸°ëŠ¥                      â”‚ âŒ ë¯¸êµ¬í˜„â”‚ 0%    â”‚
â”‚ ë°œì‹ ë²ˆí˜¸ ê´€ë¦¬                       â”‚ âš ï¸ ë³´ë¥˜ â”‚ -      â”‚
â”‚ ìˆ˜ì‹ ë²ˆí˜¸ ë‹¤ì¤‘ ì¶”ê°€ (ì£¼ì†Œë¡/ì—‘ì…€)    â”‚ âŒ ë¯¸êµ¬í˜„â”‚ 0%    â”‚
â”‚ ë©”ì‹œì§€ í…œí”Œë¦¿ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°         â”‚ âŒ ë¯¸êµ¬í˜„â”‚ 0%    â”‚
â”‚ ì¹˜í™˜ë¬¸êµ¬ ì²˜ë¦¬                       â”‚ âš ï¸ ë¶€ë¶„  â”‚ 50%   â”‚
â”‚ ì´ë¯¸ì§€ ì—…ë¡œë“œ (MMS)                 â”‚ âŒ ë¯¸êµ¬í˜„â”‚ 0%    â”‚
â”‚ ê´‘ê³ ë©”ì‹œì§€ ìë™ í‘œê¸°                â”‚ âš ï¸ ë¶€ë¶„  â”‚ 80%   â”‚
â”‚ ìµœê·¼ ë°œì†¡ ë‚´ì—­ ì¡°íšŒ                 â”‚ âŒ ë¯¸êµ¬í˜„â”‚ 0%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
2. êµ¬í˜„ ì™„ë£Œ í•­ëª© (âœ…)
================================================================================

2.1 ë°±ì—”ë“œ í•µì‹¬ ë¡œì§ (Day 1-2 ì™„ë£Œ)
-----------------------------------
âœ… src/lib/messageSender.ts - ê³µí†µ ë¡œì§ êµ¬í˜„
   - sendMessage() - ì¦‰ì‹œ ë°œì†¡
   - scheduleMessage() - ì˜ˆì•½ ë°œì†¡
   - checkBalance() - ì”ì•¡ í™•ì¸
   - deductBalance() - ì”ì•¡ ì°¨ê°
   - fromNumber íŒŒë¼ë¯¸í„° ì§€ì› (í…ŒìŠ¤íŠ¸ ë²ˆí˜¸ ì‚¬ìš©)

âœ… src/lib/naverSensApi.ts - Naver SENS API ë˜í¼
   - sendNaverSMS() - SMS/LMS ë°œì†¡
   - sendNaverMMS() - MMS ë°œì†¡
   - fromNumber íŒŒë¼ë¯¸í„° ì§€ì› ì¶”ê°€ ì™„ë£Œ

âœ… src/app/api/messages/send/route.ts - ë©”ì‹œì§€ ë°œì†¡ API
   - POST /api/messages/send
   - JWT ì¸ì¦ êµ¬í˜„
   - ë‹¤ì¤‘ ìˆ˜ì‹ ì ì§€ì›
   - ì¹˜í™˜ë¬¸êµ¬ ì²˜ë¦¬ (#[ë³€ìˆ˜ëª…] í˜•ì‹)
   - ì¦‰ì‹œ/ì˜ˆì•½ ë°œì†¡ ë¶„ê¸°
   - ê´‘ê³  ë©”ì‹œì§€ "(ê´‘ê³ )" ìë™ ì¶”ê°€ ë¡œì§

âœ… src/app/api/reservations/send-message/route.ts - ë¦¬íŒ©í† ë§
   - ê³µí†µ ë¡œì§ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½
   - ì½”ë“œ ì¤‘ë³µ ì œê±° (23% ê°ì†Œ: 300â†’230ì¤„)


2.2 í”„ë¡ íŠ¸ì—”ë“œ ê¸°ë³¸ êµ¬ì¡° (Day 6 ë¶€ë¶„ ì™„ë£Œ)
-----------------------------------------
âœ… src/components/messages/MessageSendTab.tsx
   íŒŒì¼ ìœ„ì¹˜: 46-59ì¤„
   - ë°œì‹ ë²ˆí˜¸ ìƒíƒœ (selectedSenderNumber)
   - ìˆ˜ì‹ ë²ˆí˜¸ ë°°ì—´ (recipients: Recipient[])
   - ë©”ì‹œì§€ ë°ì´í„° (messageData: MessageData)
   - ë¡œë”©/ì—ëŸ¬ ìƒíƒœ

âœ… ìˆ˜ì‹ ë²ˆí˜¸ ì§ì ‘ ì…ë ¥ ê¸°ëŠ¥
   íŒŒì¼ ìœ„ì¹˜: MessageSendTab.tsx 84-108ì¤„
   - handleAddRecipient() êµ¬í˜„
   - ì „í™”ë²ˆí˜¸ í˜•ì‹ ê²€ì¦ (/^01[0-9]{8,9}$/)
   - ì¤‘ë³µ í™•ì¸
   - ëª©ë¡ ì¶”ê°€

âœ… ì¦‰ì‹œ ë°œì†¡ ê¸°ëŠ¥
   íŒŒì¼ ìœ„ì¹˜: MessageSendTab.tsx 152-195ì¤„
   - handleImmediateSend() êµ¬í˜„
   - API í˜¸ì¶œ (/api/messages/send)
   - JWT í† í° ì „ë‹¬
   - ì„±ê³µ/ì‹¤íŒ¨ ì²˜ë¦¬
   - ë°œì†¡ í›„ ìˆ˜ì‹ ì ëª©ë¡ ì´ˆê¸°í™”

âœ… ë©”ì‹œì§€ ì‘ì„± UI
   íŒŒì¼: src/components/messages/SmsMessageContent.tsx
   - ì œëª© ì…ë ¥ (40ì ì œí•œ)
   - ë©”ì‹œì§€ ë‚´ìš© ì…ë ¥ (2000ì ì œí•œ)
   - ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ë¡œ ë°ì´í„° ì „ë‹¬ (onMessageDataChange)
   - ê¸€ì ìˆ˜ ì¹´ìš´íŒ…

âœ… ë°œì‹ ë²ˆí˜¸ ì„ íƒ ëª¨ë‹¬ (ì„ì‹œ ì²˜ë¦¬)
   íŒŒì¼ ìœ„ì¹˜: MessageSendTab.tsx 73-75ì¤„
   - í´ë¦­ ì‹œ "ê°œë°œ ì¤‘ì…ë‹ˆë‹¤" ì•Œë¦¼
   - í…ŒìŠ¤íŠ¸ ë²ˆí˜¸ë¡œ ìë™ ë°œì†¡
   - ëª¨ë‹¬ ì¸í”„ë¼ ìœ ì§€ (ì¶”í›„ êµ¬í˜„ ëŒ€ë¹„)


2.3 ë°ì´í„° íë¦„ êµ¬ì¡°
--------------------
âœ… Props ê¸°ë°˜ ë¶€ëª¨-ìì‹ í†µì‹ 
   MessageSendTab (ë¶€ëª¨)
     â†“ messageData prop
   SmsMessageContent (ìì‹)
     â†‘ onMessageDataChange callback

âœ… API ìš”ì²­ í˜•ì‹
   POST /api/messages/send
   {
     "recipients": [
       {
         "phone_number": "01012345678",
         "name": "í™ê¸¸ë™",
         "variables": {"ì´ë¦„": "í™ê¸¸ë™"}
       }
     ],
     "message": "ì•ˆë…•í•˜ì„¸ìš” #[ì´ë¦„]ë‹˜",
     "subject": "ì œëª©",
     "sendType": "immediate",
     "isAd": false
   }

âœ… API ì‘ë‹µ í˜•ì‹
   {
     "success": true,
     "results": [
       {
         "recipient": "01012345678",
         "success": true,
         "messageId": "req-123",
         "messageType": "SMS",
         "creditUsed": 20
       }
     ]
   }


================================================================================
3. ë¯¸êµ¬í˜„ í•­ëª© ë° êµ¬í˜„ ë°©ë²• (âŒ)
================================================================================

3.1 ë©”ì‹œì§€ ìˆ˜ì‹ ë²ˆí˜¸ ì¶”ê°€ ë°©ë²• (ì£¼ì†Œë¡/ì—‘ì…€/í…ìŠ¤íŠ¸)
------------------------------------------------
âŒ í˜„ì¬ ìƒíƒœ: ì§ì ‘ ì…ë ¥ë§Œ ê°€ëŠ¥
âŒ í•„ìš” ê¸°ëŠ¥:
   1. ì£¼ì†Œë¡ì—ì„œ ì„ íƒ
   2. ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ
   3. í…ìŠ¤íŠ¸ íŒŒì¼ ì—…ë¡œë“œ

ğŸ“‹ êµ¬í˜„ ë°©ë²•:

A. ì£¼ì†Œë¡ ì„ íƒ
--------------
1. DB í…Œì´ë¸” ìƒì„±
   CREATE TABLE contacts (
     id SERIAL PRIMARY KEY,
     user_id INTEGER NOT NULL REFERENCES users(id),
     name VARCHAR(100),
     phone_number VARCHAR(20) NOT NULL,
     group_name VARCHAR(100),
     created_at TIMESTAMP DEFAULT NOW()
   );

2. API ìƒì„±
   - GET /api/contacts - ì£¼ì†Œë¡ ëª©ë¡ ì¡°íšŒ
   - POST /api/contacts - ì£¼ì†Œë¡ ì¶”ê°€
   - DELETE /api/contacts/:id - ì£¼ì†Œë¡ ì‚­ì œ

3. í”„ë¡ íŠ¸ì—”ë“œ
   - AddressBookModal.tsx ì»´í¬ë„ŒíŠ¸ ìƒì„± (ìƒˆë¡œ ìƒì„± í•„ìš”)
   - fetchContacts() í•¨ìˆ˜ë¡œ API í˜¸ì¶œ
   - ì„ íƒ ì‹œ recipients ë°°ì—´ì— ì¶”ê°€

4. MessageSendTab.tsx ìˆ˜ì •
   - ì£¼ì†Œë¡ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
   - onSelectContacts() í•¸ë“¤ëŸ¬ë¡œ ì„ íƒëœ ì—°ë½ì²˜ ì¶”ê°€
   ```typescript
   const handleSelectFromAddressBook = (contacts: Contact[]) => {
     const newRecipients = contacts.map(c => ({
       phone_number: c.phone_number,
       name: c.name
     }));
     setRecipients([...recipients, ...newRecipients]);
   };
   ```

B. ì—‘ì…€ ì—…ë¡œë“œ
-------------
1. API ìƒì„±
   - POST /api/contacts/import/excel
   - íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ (multipart/form-data)
   - ì—‘ì…€ íŒŒì‹± (xlsx ë¼ì´ë¸ŒëŸ¬ë¦¬)
   - ì „í™”ë²ˆí˜¸ ì¶”ì¶œ ë° ê²€ì¦

2. í”„ë¡ íŠ¸ì—”ë“œ
   - íŒŒì¼ input ì¶”ê°€ (accept=".xlsx,.xls")
   - ì—…ë¡œë“œ ì‹œ FormData ìƒì„±
   ```typescript
   const handleExcelUpload = async (file: File) => {
     const formData = new FormData();
     formData.append('file', file);

     const response = await fetch('/api/contacts/import/excel', {
       method: 'POST',
       headers: { 'Authorization': `Bearer ${token}` },
       body: formData
     });

     const { contacts } = await response.json();
     setRecipients([...recipients, ...contacts]);
   };
   ```

C. í…ìŠ¤íŠ¸ íŒŒì¼ ì—…ë¡œë“œ
--------------------
1. í”„ë¡ íŠ¸ì—”ë“œë§Œìœ¼ë¡œ êµ¬í˜„ ê°€ëŠ¥
   - íŒŒì¼ input ì¶”ê°€ (accept=".txt")
   - FileReaderë¡œ íŒŒì¼ ì½ê¸°
   - ì¤„ë°”ê¿ˆìœ¼ë¡œ ë¶„ë¦¬ í›„ ì „í™”ë²ˆí˜¸ íŒŒì‹±
   ```typescript
   const handleTextUpload = (file: File) => {
     const reader = new FileReader();
     reader.onload = (e) => {
       const text = e.target?.result as string;
       const lines = text.split('\n');
       const phones = lines
         .map(line => line.trim().replace(/[^0-9]/g, ''))
         .filter(phone => /^01[0-9]{8,9}$/.test(phone));

       const newRecipients = phones.map(phone => ({
         phone_number: phone
       }));
       setRecipients([...recipients, ...newRecipients]);
     };
     reader.readAsText(file);
   };
   ```


3.2 ìˆ˜ì‹ ë²ˆí˜¸ ëª©ë¡ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° (ì €ì¥ ë²„íŠ¼)
------------------------------------------
âŒ í˜„ì¬ ìƒíƒœ: ë²„íŠ¼ë§Œ ì¡´ì¬, ê¸°ëŠ¥ ì—†ìŒ
âŒ ìœ„ì¹˜: MessageSendTab.tsx ìˆ˜ì‹ ë²ˆí˜¸ ì„¹ì…˜ í•˜ë‹¨

ğŸ“‹ êµ¬í˜„ ë°©ë²•:

1. DB í…Œì´ë¸” ìƒì„±
   CREATE TABLE recipient_groups (
     id SERIAL PRIMARY KEY,
     user_id INTEGER NOT NULL REFERENCES users(id),
     name VARCHAR(100) NOT NULL,
     recipients JSONB NOT NULL,
     created_at TIMESTAMP DEFAULT NOW()
   );

   ì˜ˆì‹œ ë°ì´í„°:
   {
     "name": "VIP ê³ ê°",
     "recipients": [
       {"phone_number": "01012345678", "name": "í™ê¸¸ë™"},
       {"phone_number": "01087654321", "name": "ê¹€ì² ìˆ˜"}
     ]
   }

2. API ìƒì„±
   - POST /api/recipient-groups - ì €ì¥
   - GET /api/recipient-groups - ëª©ë¡ ì¡°íšŒ
   - DELETE /api/recipient-groups/:id - ì‚­ì œ

3. í”„ë¡ íŠ¸ì—”ë“œ
   - RecipientGroupSaveModal.tsx ìƒì„±
   - RecipientGroupLoadModal.tsx ìƒì„±
   - ì €ì¥ ì‹œ í˜„ì¬ recipients ë°°ì—´ì„ JSONìœ¼ë¡œ ì €ì¥
   - ë¶ˆëŸ¬ì˜¤ê¸° ì‹œ recipients ë°°ì—´ ë³µì›


3.3 ì¹˜í™˜ë¬¸êµ¬ ê¸°ëŠ¥ (ë³€ìˆ˜ ì„ íƒ ëª¨ë‹¬)
----------------------------------
âš ï¸ í˜„ì¬ ìƒíƒœ: ë²„íŠ¼ í´ë¦­ ì‹œ "#[ë³€ìˆ˜ A]" ê³ ì • í…ìŠ¤íŠ¸ë§Œ ì‚½ì…
âš ï¸ ìœ„ì¹˜: SmsMessageContent.tsx 61-76ì¤„

ğŸ“‹ êµ¬í˜„ ë°©ë²•:

1. ë³€ìˆ˜ ì„ íƒ ëª¨ë‹¬ ìƒì„±
   - VariableSelectModal.tsx ìƒì„±
   - ì‚¬ì „ ì •ì˜ëœ ë³€ìˆ˜ ëª©ë¡ í‘œì‹œ
     * ê¸°ë³¸ ë³€ìˆ˜: ì´ë¦„, ë‚ ì§œ, ì‹œê°„, ìš”ì¼, íšŒì‚¬ëª…
     * ì»¤ìŠ¤í…€ ë³€ìˆ˜: ì‚¬ìš©ì ì •ì˜ ì…ë ¥

2. MessageSendTab.tsx ìˆ˜ì •
   - ë³€ìˆ˜ ì„ íƒ ì‹œ textareaì— ì‚½ì…
   ```typescript
   const handleInsertVariable = (varName: string) => {
     const textarea = textareaRef.current;
     const start = textarea.selectionStart;
     const text = `#[${varName}]`;
     const newContent =
       messageContent.slice(0, start) +
       text +
       messageContent.slice(textarea.selectionEnd);

     setMessageContent(newContent);
     notifyParent(subject, newContent, isAd);
   };
   ```

3. ìˆ˜ì‹ ìë³„ ë³€ìˆ˜ ê°’ ë§¤í•‘
   - ì—‘ì…€ ì—…ë¡œë“œ ì‹œ ì»¬ëŸ¼ëª… ìë™ ë§¤ì¹­
   - ìˆ˜ì‹ ì ì¶”ê°€ ì‹œ variables ê°ì²´ í•¨ê»˜ ì €ì¥
   ```typescript
   recipients: [
     {
       phone_number: "01012345678",
       name: "í™ê¸¸ë™",
       variables: {
         "ì´ë¦„": "í™ê¸¸ë™",
         "ë‚ ì§œ": "2025-10-15",
         "ì‹œê°„": "14:00"
       }
     }
   ]
   ```

4. ì „ì†¡ ì‹œ ì¹˜í™˜ ì²˜ë¦¬
   - ì´ë¯¸ APIì— êµ¬í˜„ë¨ (messages/send/route.ts 139-147ì¤„)
   - í”„ë¡ íŠ¸ì—”ë“œì—ì„œ variables ê°’ë§Œ ì œëŒ€ë¡œ ì „ë‹¬í•˜ë©´ ë¨


3.4 ì´ë¯¸ì§€ ì—…ë¡œë“œ (MMS ì „í™˜)
----------------------------
âŒ í˜„ì¬ ìƒíƒœ: í† ê¸€ ë²„íŠ¼ë§Œ ìˆìŒ (showImageUpload ìƒíƒœ)
âŒ ìœ„ì¹˜: SmsMessageContent.tsx 144-150ì¤„

ğŸ“‹ êµ¬í˜„ ë°©ë²•:

1. Supabase Storage ë²„í‚· ìƒì„±
   - message-images ë²„í‚· ìƒì„±
   - ì •ì±…: authenticated ì‚¬ìš©ìë§Œ ì—…ë¡œë“œ ê°€ëŠ¥

2. API ìƒì„±
   - POST /api/upload/message-image
   - ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
   - Supabase Storageì— ì €ì¥
   - fileId ë°˜í™˜

3. í”„ë¡ íŠ¸ì—”ë“œ
   - showImageUploadê°€ trueì¼ ë•Œ íŒŒì¼ input í‘œì‹œ
   - ì—…ë¡œë“œ ì‹œ API í˜¸ì¶œ í›„ fileId ì €ì¥
   ```typescript
   const [imageFileIds, setImageFileIds] = useState<string[]>([]);

   const handleImageUpload = async (file: File) => {
     const formData = new FormData();
     formData.append('file', file);

     const response = await fetch('/api/upload/message-image', {
       method: 'POST',
       headers: { 'Authorization': `Bearer ${token}` },
       body: formData
     });

     const { fileId } = await response.json();
     setImageFileIds([...imageFileIds, fileId]);
   };
   ```

4. ì „ì†¡ ì‹œ MMS ì²˜ë¦¬
   - messageDataì— imageFileIds ì¶”ê°€
   - APIì—ì„œ ìë™ìœ¼ë¡œ sendNaverMMS() í˜¸ì¶œ (ì´ë¯¸ êµ¬í˜„ë¨)


3.5 ë©”ì‹œì§€ í…œí”Œë¦¿ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
-------------------------------
âŒ í˜„ì¬ ìƒíƒœ: ëª¨ë‹¬ë§Œ ì—´ë¦¼, API ì—°ë™ ì—†ìŒ
âŒ ìœ„ì¹˜:
   - ì €ì¥: SmsMessageContent.tsx 151-156ì¤„ (SimpleContentSaveModal)
   - ë¶ˆëŸ¬ì˜¤ê¸°: SmsMessageContent.tsx 78-86ì¤„ (LoadContentModal)

ğŸ“‹ êµ¬í˜„ ë°©ë²•:

A. ì €ì¥ ê¸°ëŠ¥
-----------
1. DB í…Œì´ë¸” (ì´ë¯¸ ì¡´ì¬í•¨)
   âœ… message_templates í…Œì´ë¸” ì‚¬ìš©

2. API (ì´ë¯¸ ì¡´ì¬ ê°€ëŠ¥ì„± í™•ì¸ í•„ìš”)
   - POST /api/message-templates

3. SimpleContentSaveModal.tsx ìˆ˜ì •
   ```typescript
   const handleSave = async (templateName: string) => {
     const response = await fetch('/api/message-templates', {
       method: 'POST',
       headers: {
         'Content-Type': 'application/json',
         'Authorization': `Bearer ${token}`
       },
       body: JSON.stringify({
         name: templateName,
         content: messageContent,
         subject: subject,
         category: 'ì¼ë°˜',
         is_private: true
       })
     });

     if (response.ok) {
       alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
       onClose();
     }
   };
   ```

B. ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥
--------------
1. API
   - GET /api/message-templates?category=private

2. LoadContentModal.tsx ìˆ˜ì •
   - saved íƒ­: ì €ì¥ëœ í…œí”Œë¦¿ ëª©ë¡
   - recent íƒ­: ìµœê·¼ ë°œì†¡ ë‚´ì—­ (message_logs í•„ìš”)

   ```typescript
   const fetchTemplates = async () => {
     const response = await fetch('/api/message-templates', {
       headers: { 'Authorization': `Bearer ${token}` }
     });
     const { data } = await response.json();
     setTemplates(data);
   };

   const handleSelectTemplate = (template: Template) => {
     onSelect({
       subject: template.subject,
       content: template.content,
       isAd: false
     });
     onClose();
   };
   ```


3.6 ìµœê·¼ ë°œì†¡ ë‚´ì—­ ì¡°íšŒ
-----------------------
âŒ í˜„ì¬ ìƒíƒœ: ë²„íŠ¼ë§Œ ìˆìŒ (LoadContentModal recent íƒ­)
âŒ ìœ„ì¹˜: SmsMessageContent.tsx 83-86ì¤„

ğŸ“‹ êµ¬í˜„ ë°©ë²•:

1. DB í…Œì´ë¸” ìƒì„± (ê³„íš ë¬¸ì„œì— ìˆìŒ)
   CREATE TABLE message_logs (
     id SERIAL PRIMARY KEY,
     user_id INTEGER NOT NULL REFERENCES users(id),
     to_number VARCHAR(20) NOT NULL,
     to_name VARCHAR(100),
     message_content TEXT NOT NULL,
     subject VARCHAR(100),
     message_type VARCHAR(10) NOT NULL,
     sent_at TIMESTAMP,
     status VARCHAR(20) NOT NULL,
     error_message TEXT,
     credit_used INTEGER,
     metadata JSONB,
     created_at TIMESTAMP DEFAULT NOW()
   );

2. messageSender.ts ìˆ˜ì •
   - sendMessage() í•¨ìˆ˜ì— ë¡œê·¸ ì €ì¥ ë¡œì§ ì¶”ê°€
   ```typescript
   // ë°œì†¡ ì„±ê³µ ì‹œ
   await supabase.from('message_logs').insert({
     user_id: userId,
     to_number: cleanPhone,
     to_name: toName,
     message_content: message,
     subject: subject,
     message_type: messageType,
     sent_at: new Date().toISOString(),
     status: 'sent',
     credit_used: creditRequired,
     metadata: metadata
   });
   ```

3. API ìƒì„±
   - GET /api/message-logs?limit=10

4. LoadContentModal.tsx ìˆ˜ì •
   - recent íƒ­ì—ì„œ API í˜¸ì¶œ
   - ë°œì†¡ ë‚´ì—­ ëª©ë¡ í‘œì‹œ
   - ì„ íƒ ì‹œ ë‚´ìš© ë³µì›


3.7 ê´‘ê³ ë©”ì‹œì§€ ìë™ í‘œê¸°
------------------------
âš ï¸ í˜„ì¬ ìƒíƒœ: ë°±ì—”ë“œ ë¡œì§ ì™„ë£Œ, í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ë¶€ì¡±
âš ï¸ ë°±ì—”ë“œ: /api/messages/send (127-130ì¤„) - "(ê´‘ê³ )" ìë™ ì¶”ê°€ êµ¬í˜„ë¨
âš ï¸ í”„ë¡ íŠ¸ì—”ë“œ: isAd ê°’ì„ APIë¡œ ì „ë‹¬ ì•ˆ í•¨

ğŸ“‹ êµ¬í˜„ ë°©ë²•:

1. MessageSendTab.tsx ìˆ˜ì •
   - handleImmediateSend() í•¨ìˆ˜ì˜ bodyì— isAd ì¶”ê°€

   í˜„ì¬ ì½”ë“œ (168-175ì¤„):
   ```typescript
   body: JSON.stringify({
     from_number: selectedSenderNumber,
     recipients: recipients,
     message: messageData.content,
     subject: messageData.subject || undefined,
     sendType: "immediate",
     isAd: messageData.isAd  // âœ… ì´ë¯¸ ì „ë‹¬ ì¤‘!
   })
   ```

   âœ… ì‹¤ì œë¡œ ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆìŒ!
   âœ… ë‹¨, ì²´í¬ë°•ìŠ¤ UI í™•ì¸ í•„ìš”

2. SmsMessageContent.tsx í™•ì¸
   - isAd ì²´í¬ë°•ìŠ¤ê°€ ì œëŒ€ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
   - ì²´í¬ ì‹œ ë¶€ëª¨ë¡œ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸


3.8 ì˜ˆì•½ ë°œì†¡ ê¸°ëŠ¥
------------------
âŒ í˜„ì¬ ìƒíƒœ: APIëŠ” êµ¬í˜„ë¨, í”„ë¡ íŠ¸ì—”ë“œ UI ì—†ìŒ
âŒ ë°±ì—”ë“œ: /api/messages/send (sendType: 'scheduled' ì§€ì›)

ğŸ“‹ êµ¬í˜„ ë°©ë²•:

1. DB í…Œì´ë¸” ìƒì„± (ê³„íš ë¬¸ì„œì— ìˆìŒ)
   CREATE TABLE scheduled_messages (
     id SERIAL PRIMARY KEY,
     user_id INTEGER NOT NULL REFERENCES users(id),
     to_number VARCHAR(20) NOT NULL,
     to_name VARCHAR(100),
     message_content TEXT NOT NULL,
     subject VARCHAR(100),
     scheduled_at TIMESTAMP NOT NULL,
     status VARCHAR(20) DEFAULT 'pending',
     sent_at TIMESTAMP,
     error_message TEXT,
     metadata JSONB,
     created_at TIMESTAMP DEFAULT NOW()
   );

2. í”„ë¡ íŠ¸ì—”ë“œ UI ì¶”ê°€
   - ScheduleModal.tsx ìƒì„±
   - ë‚ ì§œ/ì‹œê°„ ì„ íƒ (DatePicker)
   - MessageSendTab.tsxì— "ì˜ˆì•½ ì „ì†¡" ë²„íŠ¼ ì¶”ê°€

3. ì˜ˆì•½ ì „ì†¡ í•¸ë“¤ëŸ¬
   ```typescript
   const handleScheduledSend = async (scheduledAt: string) => {
     const response = await fetch('/api/messages/send', {
       method: 'POST',
       headers: {
         'Content-Type': 'application/json',
         'Authorization': `Bearer ${token}`
       },
       body: JSON.stringify({
         recipients,
         message: messageData.content,
         subject: messageData.subject,
         sendType: 'scheduled',
         scheduledAt: scheduledAt,  // ISO 8601 í˜•ì‹
         isAd: messageData.isAd
       })
     });
   };
   ```

4. ì˜ˆì•½ ë©”ì‹œì§€ ê´€ë¦¬ í˜ì´ì§€
   - GET /api/messages/scheduled - ëª©ë¡ ì¡°íšŒ
   - DELETE /api/messages/scheduled?id=123 - ì·¨ì†Œ


================================================================================
4. ë‹¤ìŒ ë‹¨ê³„ ìš°ì„ ìˆœìœ„
================================================================================

ìš°ì„ ìˆœìœ„ 1 (ì¦‰ì‹œ êµ¬í˜„ í•„ìš”) ğŸ”´
-----------------------------
1. âœ… ê´‘ê³ ë©”ì‹œì§€ isAd ì „ë‹¬ í™•ì¸
   - ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆìŒ (í™•ì¸ë§Œ í•„ìš”)

2. âŒ ë©”ì‹œì§€ í…œí”Œë¦¿ API ì—°ë™
   - SimpleContentSaveModal.tsxì— POST API ì¶”ê°€
   - LoadContentModal.tsxì— GET API ì¶”ê°€
   - 2ì‹œê°„ ì†Œìš” ì˜ˆìƒ

3. âŒ ì—‘ì…€ ì—…ë¡œë“œ (ìˆ˜ì‹ ì ì¶”ê°€)
   - /api/contacts/import/excel êµ¬í˜„
   - íŒŒì¼ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬ ì¶”ê°€
   - 4ì‹œê°„ ì†Œìš” ì˜ˆìƒ


ìš°ì„ ìˆœìœ„ 2 (í•µì‹¬ ê¸°ëŠ¥) ğŸŸ¡
-------------------------
4. âŒ ì˜ˆì•½ ë°œì†¡ ê¸°ëŠ¥
   - scheduled_messages í…Œì´ë¸” ìƒì„±
   - ScheduleModal.tsx ì»´í¬ë„ŒíŠ¸ ìƒì„±
   - ì˜ˆì•½ ê´€ë¦¬ í˜ì´ì§€ ì¶”ê°€
   - 6ì‹œê°„ ì†Œìš” ì˜ˆìƒ

5. âŒ ì¹˜í™˜ë¬¸êµ¬ ë³€ìˆ˜ ì„ íƒ ëª¨ë‹¬
   - VariableSelectModal.tsx ìƒì„±
   - ê¸°ë³¸ ë³€ìˆ˜ ëª©ë¡ ì •ì˜
   - 2ì‹œê°„ ì†Œìš” ì˜ˆìƒ

6. âŒ ì£¼ì†Œë¡ ê¸°ëŠ¥
   - contacts í…Œì´ë¸” ìƒì„±
   - CRUD API êµ¬í˜„
   - AddressBookModal.tsx ìƒì„±
   - 6ì‹œê°„ ì†Œìš” ì˜ˆìƒ


ìš°ì„ ìˆœìœ„ 3 (ê³ ê¸‰ ê¸°ëŠ¥) ğŸŸ¢
-------------------------
7. âŒ ì´ë¯¸ì§€ ì—…ë¡œë“œ (MMS)
   - Supabase Storage ì„¤ì •
   - /api/upload/message-image êµ¬í˜„
   - íŒŒì¼ ì—…ë¡œë“œ UI ì¶”ê°€
   - 4ì‹œê°„ ì†Œìš” ì˜ˆìƒ

8. âŒ ìµœê·¼ ë°œì†¡ ë‚´ì—­
   - message_logs í…Œì´ë¸” ìƒì„±
   - ë¡œê·¸ ì €ì¥ ë¡œì§ ì¶”ê°€
   - /api/message-logs êµ¬í˜„
   - LoadContentModal recent íƒ­ ì—°ë™
   - 3ì‹œê°„ ì†Œìš” ì˜ˆìƒ

9. âŒ ìˆ˜ì‹ ë²ˆí˜¸ ê·¸ë£¹ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
   - recipient_groups í…Œì´ë¸” ìƒì„±
   - CRUD API êµ¬í˜„
   - ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ëª¨ë‹¬ ìƒì„±
   - 3ì‹œê°„ ì†Œìš” ì˜ˆìƒ


ë³´ë¥˜ í•­ëª© â¸ï¸
------------
- ë°œì‹ ë²ˆí˜¸ ê´€ë¦¬: ì‚¬ìš©ì ìš”ì²­ì— ë”°ë¼ í˜„ì¬ í…ŒìŠ¤íŠ¸ ë²ˆí˜¸ë§Œ ì‚¬ìš©
- MMS ê¸°ëŠ¥: ìš°ì„ ìˆœìœ„ ë‚®ìŒ


================================================================================
5. êµ¬í˜„ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸
================================================================================

Phase 1: í•µì‹¬ ë°œì†¡ ê¸°ëŠ¥
-----------------------
[âœ…] ê³µí†µ ë¡œì§ êµ¬í˜„ (messageSender.ts)
[âœ…] ë©”ì‹œì§€ ë°œì†¡ API (ì¦‰ì‹œ ë°œì†¡)
[âœ…] í”„ë¡ íŠ¸ì—”ë“œ ê¸°ë³¸ êµ¬ì¡°
[âœ…] ìˆ˜ì‹ ë²ˆí˜¸ ì§ì ‘ ì…ë ¥
[âœ…] ë©”ì‹œì§€ ì‘ì„± UI
[âœ…] ì¦‰ì‹œ ì „ì†¡ ê¸°ëŠ¥
[âŒ] ì˜ˆì•½ ì „ì†¡ ê¸°ëŠ¥
[âŒ] ì˜ˆì•½ ë©”ì‹œì§€ ê´€ë¦¬

Phase 2: ìˆ˜ì‹ ì ê´€ë¦¬
--------------------
[âœ…] ì§ì ‘ ì…ë ¥
[âŒ] ì£¼ì†Œë¡ ì„ íƒ
[âŒ] ì—‘ì…€ ì—…ë¡œë“œ
[âŒ] í…ìŠ¤íŠ¸ íŒŒì¼ ì—…ë¡œë“œ
[âŒ] ìˆ˜ì‹ ì ê·¸ë£¹ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°

Phase 3: ë©”ì‹œì§€ ì‘ì„± ê³ ê¸‰ ê¸°ëŠ¥
-----------------------------
[âš ï¸] ì¹˜í™˜ë¬¸êµ¬ (ê¸°ë³¸ ì‚½ì…ë§Œ ê°€ëŠ¥)
[âŒ] ë³€ìˆ˜ ì„ íƒ ëª¨ë‹¬
[âŒ] ì´ë¯¸ì§€ ì—…ë¡œë“œ (MMS)
[âœ…] ê´‘ê³  ë©”ì‹œì§€ í‘œê¸°

Phase 4: í…œí”Œë¦¿ ê´€ë¦¬
-------------------
[âŒ] í…œí”Œë¦¿ ì €ì¥ (API ì—°ë™ í•„ìš”)
[âŒ] í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸° (API ì—°ë™ í•„ìš”)
[âŒ] ìµœê·¼ ë°œì†¡ ë‚´ì—­

Phase 5: ë°œì‹ ë²ˆí˜¸ ê´€ë¦¬
---------------------
[â¸ï¸] ë°œì‹ ë²ˆí˜¸ ë“±ë¡
[â¸ï¸] ë°œì‹ ë²ˆí˜¸ ì¸ì¦
[â¸ï¸] ê¸°ë³¸ ë°œì‹ ë²ˆí˜¸ ì„¤ì •
[âœ…] í…ŒìŠ¤íŠ¸ ë²ˆí˜¸ ì‚¬ìš© (ì„ì‹œ)


================================================================================
ë¬¸ì„œ ë
================================================================================
ìµœì¢… ì—…ë°ì´íŠ¸: 2025-10-13
ë‹¤ìŒ ì—…ë°ì´íŠ¸: ê° ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ ì‹œ
