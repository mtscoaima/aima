# MTS API 통합 테스트 가이드

> **프로젝트**: MTS Message Portal
> **작성일**: 2025-10-29
> **최종 업데이트**: 2025-11-03
> **버전**: v1.7 (테스트 재시작)
> **목적**: MTS API 전환 후 전체 기능 통합 테스트 가이드
> **대상**: QA 팀, 개발자, 프로젝트 관리자

---

## 🚨 현재 테스트 현황 (2025-11-03 재시작)

### 📋 테스트 범위

**✅ 이번 테스트에서 확인할 항목:**
1. UI 기능 동작 확인 (폼, 버튼, 드롭다운)
2. MTS API Request/Response 확인
3. DB 저장 확인 (message_logs, transactions)
4. 잔액 차감 로직 확인

**⏸️ 추후 확인할 항목 (현재 제외):**
1. 실제 메시지 수신 (카카오톡/네이버 앱)
2. 발신번호 등록 API
3. 템플릿 등록 및 승인 프로세스

### 📊 테스트 진행 상태
- ✅ **Phase 1-2**: SMS/LMS/MMS (기존 완료, 재테스트 불필요)
- 🔄 **Phase 3**: 카카오 알림톡 (재시작)
- 🔄 **Phase 4**: 카카오 친구톡 (재시작)
- 🔄 **Phase 5**: 네이버 톡톡 (재시작)
- 🔄 **Phase 6**: 카카오 브랜드 메시지 (재시작, UI 재설계 완료)

### 💰 메시지 요금표 (2025-11-03 업데이트)

| 구분 | 메시지 | 단가 (크레딧) |
|------|--------|---------------|
| 문자메시지 | SMS | 25원 |
| 문자메시지 | LMS | 50원 |
| 문자메시지 | MMS | 100원 |
| 카카오 | 알림톡 | 13원 |
| 카카오 | 친구톡 | 20원 |
| 카카오 | 브랜드톡 | 20원 |
| 네이버 | 스마트알림 | 13원 |
| 네이버 | 톡톡광고 | 20원 |

### ✅ 완료된 작업 (2025-11-03)
- **요금 수정**: 모든 API 엔드포인트 요금 업데이트 완료
- **BrandTab UI 재설계**: 템플릿 선택 방식 + Rich UI (579줄)
- **브랜드 템플릿 조회 API**: fetchBrandTemplates() 구현 완료

---

## 📋 목차

1. [테스트 개요](#테스트-개요)
2. [테스트 환경 설정](#테스트-환경-설정)
3. [Phase 3: 카카오 알림톡](#phase-3-카카오-알림톡)
4. [Phase 4: 카카오 친구톡](#phase-4-카카오-친구톡)
5. [Phase 5: 네이버 톡톡](#phase-5-네이버-톡톡)
6. [Phase 6: 카카오 브랜드 메시지](#phase-6-카카오-브랜드-메시지)

---

## 테스트 개요

### 테스트 목적
- MTS API 전환 작업 검증
- UI/API/DB 연동 확인
- 요금 차감 로직 검증

### 테스트 범위
- **포함**: UI 기능, API Request/Response, DB 저장, 잔액 차감
- **제외**: 실제 메시지 수신 (MTS 환경 설정 대기)

---

## 테스트 환경 설정

### 1. 필수 환경 변수 확인
```bash
NEXT_PUBLIC_SUPABASE_URL=        # Supabase URL
SUPABASE_SERVICE_ROLE_KEY=       # Service Role Key
MTS_AUTH_CODE=                   # MTS 인증 코드
MTS_API_URL=                     # MTS API URL
```

### 2. 테스트 수신번호 준비
- 본인 휴대폰 번호 (01012345678 형식)

### 3. 카카오/네이버 계정 준비
- 카카오 발신프로필 (senderKey)
- 네이버 톡톡 ID (navertalkId)

---

## Phase 3: 카카오 알림톡

### 📌 사전 조건
- [ ] 카카오 발신프로필 등록 완료
- [ ] 알림톡 템플릿 등록 및 승인 완료

### 📋 Phase 3 테스트 체크리스트

**3.1 알림톡 템플릿 조회**
- [ ] 발신프로필 선택 시 템플릿 자동 로딩
- [ ] 템플릿 목록 드롭다운 표시
- [ ] 템플릿 선택 시 내용 미리보기 표시

**3.2 알림톡 발송**
- [ ] 템플릿 변수 치환 입력
- [ ] 발송 버튼 클릭
- [ ] MTS API 응답 코드 `0000` 또는 `1000` 확인
- [ ] DB 저장 확인 (message_logs)
- [ ] 잔액 13원 차감 확인 (transactions)

**3.3 알림톡 → SMS 전환 발송**
- [ ] 전환 발송 설정 (SMS/LMS/MMS)
- [ ] 전환 메시지 입력
- [ ] metadata에 tran_type 저장 확인

### 테스트 시나리오 3.1: 알림톡 발송 (템플릿 변수 치환)

**테스트 단계:**
1. "카카오/네이버 톡톡" 탭 → "알림톡" 서브 탭
2. Kakao Channel 선택 (발신프로필)
3. 템플릿 자동 로딩 확인
4. 템플릿 선택
5. 변수 치환 (#{고객명} → "홍길동")
6. 수신자 입력 (01012345678)
7. 발송 버튼 클릭

**예상 결과:**
- [ ] MTS API Request 확인 (Network 탭)
- [ ] MTS API Response 확인 (응답 코드 0000/1000)
- [ ] DB 저장 확인 (message_type='KAKAO_ALIMTALK')
- [ ] 잔액 13원 차감 확인
- ⏸️ 실제 메시지 수신 확인 (추후 테스트)

**DB 확인:**
```sql
-- message_logs 확인
SELECT * FROM message_logs
WHERE user_id = YOUR_USER_ID
ORDER BY created_at DESC LIMIT 1;

-- transactions 확인
SELECT * FROM transactions
WHERE user_id = YOUR_USER_ID
ORDER BY created_at DESC LIMIT 1;
```

---

## Phase 4: 카카오 친구톡

### 📌 사전 조건
- [ ] 카카오 발신프로필 등록 완료
- [ ] 친구톡 발송 권한 획득

### 📋 Phase 4 테스트 체크리스트

**4.1 텍스트형 친구톡 (FT)**
- [ ] 메시지 타입 선택 (FT)
- [ ] 메시지 내용 입력
- [ ] 광고 여부 선택 (Y/N)
- [ ] 발송 버튼 클릭
- [ ] MTS API 응답 코드 확인
- [ ] DB 저장 확인
- [ ] 잔액 20원 차감 확인

**4.2 이미지형 친구톡 (FI)**
- [ ] 메시지 타입 선택 (FI)
- [ ] 이미지 URL 입력
- [ ] 메시지 내용 입력
- [ ] 발송 확인

**4.3 광고형 친구톡**
- [ ] ad_flag='Y' 선택
- [ ] 광고 문구 포함 확인
- [ ] 발송 시간 제한 확인 (08:00-20:00)

### 테스트 시나리오 4.1: 텍스트형 친구톡 (FT)

**테스트 단계:**
1. "카카오/네이버 톡톡" 탭 → "친구톡" 서브 탭
2. Kakao Channel 선택
3. 메시지 타입: FT (텍스트형)
4. 광고 여부: N
5. 메시지 내용 입력
6. 수신자 입력
7. 발송 버튼 클릭

**예상 결과:**
- [ ] MTS API Request 확인
- [ ] MTS API Response 확인 (응답 코드 0000/1000)
- [ ] DB 저장 확인 (message_type='KAKAO_FRIENDTALK')
- [ ] 잔액 20원 차감 확인
- ⏸️ 실제 메시지 수신 확인 (추후 테스트)

---

## Phase 5: 네이버 톡톡

### 📌 사전 조건
- [ ] 네이버 톡톡 계정 등록
- [ ] 템플릿 등록 및 승인 완료

### 📋 Phase 5 테스트 체크리스트

**5.1 네이버 톡톡 발송**
- [ ] 네이버톡 ID 입력
- [ ] 템플릿 자동 로딩 확인
- [ ] 템플릿 선택
- [ ] 상품 코드 선택 (INFORMATION/BENEFIT/CARDINFO)
- [ ] 발송 확인
- [ ] 잔액 차감 확인 (스마트알림: 13원, 광고: 20원)

### 테스트 시나리오 5.1: 네이버 톡톡 발송

**테스트 단계:**
1. "카카오/네이버 톡톡" 탭 → "네이버" 서브 탭
2. 네이버톡 ID 입력
3. 템플릿 자동 로딩 확인
4. 템플릿 선택
5. 상품 코드 선택
   - INFORMATION: 스마트알림 (13원)
   - BENEFIT: 광고 (20원)
   - CARDINFO: 스마트알림 (13원)
6. 템플릿 변수 치환
7. 수신자 입력
8. 발송 버튼 클릭

**예상 결과:**
- [ ] MTS API Request 확인
- [ ] MTS API Response 확인
- [ ] DB 저장 확인 (message_type='NAVERTALK')
- [ ] 잔액 차감 확인 (상품 코드별)
- ⏸️ 실제 메시지 수신 확인 (추후 테스트)

---

## Phase 6: 카카오 브랜드 메시지

### 📌 사전 조건
- [ ] 카카오 브랜드 메시지 권한 획득
- [ ] 브랜드 템플릿 등록 및 승인 완료

### 🔧 주요 변경사항 (v1.7 - 2025-11-03)
- **구조 변경**: 수동 입력 방식 → 템플릿 선택 방식 (완료)
- **워크플로우**: 알림톡과 동일한 방식 적용
- **UI**: BrandTab.tsx 완전 재작성 (579줄, Rich UI 구조)
- **템플릿 조회**: fetchBrandTemplates() 함수 구현 완료
- **Rich UI**: 템플릿 미리보기, 원형 차트, 변수 치환 등 8개 섹션

### 📋 Phase 6 테스트 체크리스트

**6.0 브랜드 템플릿 조회**
- [ ] 발신프로필 선택 시 템플릿 자동 로딩
- [ ] 템플릿 목록 드롭다운 표시
- [ ] 8가지 메시지 타입 필터링 확인
  - TEXT, IMAGE, WIDE, WIDE_ITEM_LIST
  - CAROUSEL_FEED, COMMERCE, CAROUSEL_COMMERCE, PREMIUM_VIDEO
- [ ] 템플릿 선택 시 Template Preview 업데이트
- [ ] Rich UI 구조 8개 섹션 표시 확인

**6.1 브랜드 메시지 발송**
- [ ] 템플릿 선택
- [ ] 템플릿 내용 미리보기 확인
- [ ] 변수 치환 (있는 경우)
- [ ] SMS 백업 설정 (N/S/L/M)
- [ ] 발송 버튼 클릭
- [ ] MTS API 응답 코드 확인
- [ ] DB 저장 확인
- [ ] 잔액 20원 차감 확인

### 테스트 시나리오 6.0: 브랜드 템플릿 조회 기능

**목적**: 발신프로필 선택 시 브랜드 템플릿 자동 로딩 확인

**API 엔드포인트**: `/api/kakao/templates?senderKey={senderKey}`

**테스트 단계:**
1. "카카오/네이버 톡톡" 탭 → "브랜드 메시지" 서브 탭
2. Kakao Channel 섹션에서 발신프로필 선택
3. 템플릿 자동 로딩 확인
4. 드롭다운에서 템플릿 목록 확인

**예상 결과:**
- [ ] 발신프로필 선택 시 즉시 템플릿 로딩 시작
- [ ] 로딩 중 "템플릿 목록을 불러오는 중입니다..." 표시
- [ ] 템플릿 목록이 드롭다운에 표시됨
- [ ] 각 템플릿 항목: `템플릿명 (템플릿코드)`
- [ ] 승인된 템플릿만 표시
- [ ] 템플릿 없을 경우 "등록된 템플릿이 없습니다" 표시

**Rich UI 구조 확인:**
- [ ] 섹션 1: Kakao Channel + Brand Template 선택 (side by side)
- [ ] 섹션 2: Template Preview (8가지 형식 타입 버튼)
- [ ] 섹션 3: Template Info + Example Images
- [ ] 섹션 4: Total Recipients + Targeting (원형 차트)
- [ ] 섹션 5: Text Replacement (변수 치환)
- [ ] 섹션 6: SMS Backup Settings (N/S/L/M 버튼)
- [ ] 섹션 7: Recipient Information (건수 + 예상 금액)
- [ ] 섹션 8: Send Button

**템플릿 선택 시 동작 확인:**
- [ ] 템플릿 선택 시 Template Preview 섹션 업데이트
- [ ] 선택된 템플릿의 message_type에 해당하는 버튼 활성화
- [ ] Template Info 섹션에 템플릿 내용 표시 (읽기 전용)
- [ ] 템플릿에 변수가 있을 경우 Text Replacement 섹션 표시

### 테스트 시나리오 6.1: 텍스트형 브랜드 메시지 (TEXT)

**테스트 단계:**
1. "카카오/네이버 톡톡" 탭 → "브랜드 메시지" 서브 탭
2. 발신프로필 선택
3. 템플릿 선택 (TEXT 타입)
4. 템플릿 미리보기 확인
5. 변수 치환 (있는 경우)
6. SMS 백업 설정 (N/S/L/M)
7. 수신자 입력
8. 발송 버튼 클릭

**예상 결과:**
- [ ] MTS API Request 확인
- [ ] MTS API Response 확인 (응답 코드 0000/1000)
- [ ] DB 저장 확인 (message_type='BRAND_MESSAGE')
- [ ] 잔액 20원 차감 확인
- [ ] metadata에 template_code, message_type 저장 확인
- ⏸️ 실제 메시지 수신 확인 (추후 테스트)

---

## 최종 체크리스트

### ✅ 카카오 알림톡 (필수)
- [ ] 템플릿 조회 기능
- [ ] 변수 치환 발송
- [ ] 버튼 기능
- [ ] SMS 전환 발송
- [ ] 잔액 13원 차감 확인

### ✅ 카카오 친구톡 (필수)
- [ ] 텍스트형 (FT)
- [ ] 이미지형 (FI)
- [ ] 와이드형 (FW)
- [ ] 광고형 (ad_flag=Y)
- [ ] 잔액 20원 차감 확인

### ✅ 네이버 톡톡 (중요)
- [ ] 템플릿 조회
- [ ] 스마트알림 발송 (13원)
- [ ] 광고 발송 (20원)
- [ ] 상품 코드별 요금 확인

### ✅ 카카오 브랜드 메시지 (필수)
- [ ] 템플릿 조회 기능
- [ ] Rich UI 8개 섹션 확인
- [ ] 텍스트형 발송
- [ ] 이미지형 발송
- [ ] 잔액 20원 차감 확인

---

## 테스트 결과 기록 양식

### Phase 3: 카카오 알림톡
```
테스트 일시:
테스터:
결과: [ ] 성공 [ ] 실패
비고:
```

### Phase 4: 카카오 친구톡
```
테스트 일시:
테스터:
결과: [ ] 성공 [ ] 실패
비고:
```

### Phase 5: 네이버 톡톡
```
테스트 일시:
테스터:
결과: [ ] 성공 [ ] 실패
비고:
```

### Phase 6: 카카오 브랜드 메시지
```
테스트 일시:
테스터:
결과: [ ] 성공 [ ] 실패
비고:
```

---

## 참고 문서

- [MTS_API_전환_통합_가이드.md](./MTS_API_전환_통합_가이드.md)
- [MTS_API_사용_현황_템플릿.txt](./MTS_API_사용_현황_템플릿.txt)
- [MTS_API_코드_위치_안내.txt](./MTS_API_코드_위치_안내.txt)

---

**문서 버전**: v1.7
**작성**: 2025-11-03
**다음 업데이트 예정**: 테스트 완료 후
