# MTS API 통합 테스트 가이드

> **프로젝트**: MTS Message Portal
> **작성일**: 2025-10-29
> **최종 업데이트**: 2025-11-03
> **버전**: v1.7 (테스트 재시작)
> **목적**: MTS API 전환 후 전체 기능 통합 테스트 가이드
> **대상**: QA 팀, 개발자, 프로젝트 관리자

---

## 🚨 현재 테스트 현황 (2025-11-03 재시작)

### 📋 테스트 범위

**✅ 이번 테스트에서 확인할 항목:**
1. UI 기능 동작 확인 (폼, 버튼, 드롭다운)
2. MTS API Request/Response 확인
3. DB 저장 확인 (message_logs, transactions)
4. 잔액 차감 로직 확인

**⏸️ 추후 확인할 항목 (현재 제외):**
1. 실제 메시지 수신 (카카오톡/네이버 앱)
2. 발신번호 등록 API
3. 템플릿 등록 및 승인 프로세스

### 📊 테스트 진행 상태
- ✅ **Phase 1-2**: SMS/LMS/MMS (완료)
- ✅ **Phase 3**: 카카오 알림톡 (완료 - 2025-11-03)
- 🔄 **Phase 4**: 카카오 친구톡 (다음 예정)
- 🔄 **Phase 5**: 네이버 톡톡 (대기 중)
- 🔄 **Phase 6**: 카카오 브랜드 메시지 (대기 중, UI 재설계 완료)

### 💰 메시지 요금표 (2025-11-03 업데이트)

| 구분 | 메시지 | 단가 (크레딧) |
|------|--------|---------------|
| 문자메시지 | SMS | 25원 |
| 문자메시지 | LMS | 50원 |
| 문자메시지 | MMS | 100원 |
| 카카오 | 알림톡 | 13원 |
| 카카오 | 친구톡 | 20원 |
| 카카오 | 브랜드톡 | 20원 |
| 네이버 | 스마트알림 | 13원 |
| 네이버 | 톡톡광고 | 20원 |

### ✅ 완료된 작업 (2025-11-03)
- **요금 수정**: 모든 API 엔드포인트 요금 업데이트 완료
- **BrandTab UI 재설계**: 템플릿 선택 방식 + Rich UI (579줄)
- **브랜드 템플릿 조회 API**: fetchBrandTemplates() 구현 완료

---

## 📋 목차

1. [테스트 개요](#테스트-개요)
2. [테스트 환경 설정](#테스트-환경-설정)
3. [Phase 1-2: SMS/LMS/MMS](#phase-1-2-smslmsmms) (참고용, 완료됨)
4. [Phase 3: 카카오 알림톡](#phase-3-카카오-알림톡)
5. [Phase 4: 카카오 친구톡](#phase-4-카카오-친구톡)
6. [Phase 5: 네이버 톡톡](#phase-5-네이버-톡톡)
7. [Phase 6: 카카오 브랜드 메시지](#phase-6-카카오-브랜드-메시지)

---

## 테스트 개요

### 테스트 목적
- MTS API 전환 작업 검증
- UI/API/DB 연동 확인
- 요금 차감 로직 검증

### 테스트 범위
- **포함**: UI 기능, API Request/Response, DB 저장, 잔액 차감
- **제외**: 실제 메시지 수신 (MTS 환경 설정 대기)

---

## 테스트 환경 설정

### 1. 필수 환경 변수 확인
```bash
NEXT_PUBLIC_SUPABASE_URL=        # Supabase URL
SUPABASE_SERVICE_ROLE_KEY=       # Service Role Key
MTS_AUTH_CODE=                   # MTS 인증 코드
MTS_API_URL=                     # MTS API URL
```

### 2. 테스트 수신번호 준비
- 본인 휴대폰 번호 (01012345678 형식)

### 3. 카카오/네이버 계정 준비
- 카카오 발신프로필 (senderKey)
- 네이버 톡톡 ID (navertalkId)

---

## Phase 1-2: SMS/LMS/MMS

> ✅ **상태**: 테스트 완료 (2025-11-03)
>
> 이 섹션은 참고용입니다. Phase 1-2는 이미 완료되었으며 재테스트가 필요하지 않습니다.

### 📌 완료된 작업
- ✅ SMS/LMS 자동 판단 로직 구현
- ✅ MMS 이미지 업로드 기능 (PNG → JPEG 변환, 640×480px, 300KB)
- ✅ 메시지 발송 API 통합 (MTS API)
- ✅ 잔액 차감 로직 (SMS: 25원, LMS: 50원, MMS: 100원)
- ✅ 메시지 로그 저장 (message_logs)
- ✅ 거래 내역 저장 (transactions)

### 📋 Phase 1-2 테스트 요약 (참고용)

**1.1 SMS 발송 (90바이트 이하)**
- 메시지 타입: SMS
- 예제: "안녕하세요" (15바이트)
- 단가: 25원
- 테스트 결과: ✅ 성공

**1.2 LMS 발송 (90바이트 초과)**
- 메시지 타입: LMS
- 예제: "안녕하세요 고객님, 예약이 정상적으로 완료되었습니다." (93바이트)
- 단가: 50원
- subject 자동 추가: "LMS"
- 테스트 결과: ✅ 성공

**1.3 MMS 발송 (이미지 포함)**
- 메시지 타입: MMS
- 이미지 최적화: PNG → JPEG, 640×480px, 300KB
- 단가: 100원
- subject 자동 추가: "MMS"
- attachment 객체 생성: `{ image: [{ img_url: "..." }] }`
- 테스트 결과: ✅ 성공

### 🔍 주요 확인 사항 (완료)

**메시지 타입 자동 판단:**
```typescript
// src/utils/messageTemplateParser.ts
- 이미지 첨부됨 → MMS
- 메시지 90바이트 초과 → LMS
- 그 외 → SMS
```

**이미지 업로드 워크플로우:**
```
1. 사용자 이미지 업로드 (최대 5MB)
   ↓
2. Sharp 라이브러리로 최적화
   - PNG → JPEG 변환
   - 640×480px 리사이즈
   - 300KB 이하로 압축
   ↓
3. MTS 이미지 업로드 API 호출
   - 엔드포인트: https://api.mtsco.co.kr/img/upload_image
   - 응답: { code: "0000", image: "/2025/11/03/..." }
   ↓
4. 이미지 URL 저장 (Frontend State)
   ↓
5. MMS 발송 시 attachment 객체에 포함
```

**잔액 차감 로직:**
```typescript
// src/lib/messageSender.ts
- SMS: 25원 차감 (transactions 테이블 usage 기록)
- LMS: 50원 차감
- MMS: 100원 차감
- metadata: { usage_type: 'message_send', message_type: 'SMS/LMS/MMS' }
```

**DB 저장 확인:**
```sql
-- message_logs 테이블
SELECT
  id,
  user_id,
  to_number,
  message_type, -- 'SMS', 'LMS', 'MMS'
  message_content,
  credit_used, -- 25, 50, 100
  status, -- 'sent'
  created_at
FROM message_logs
WHERE user_id = YOUR_USER_ID
ORDER BY created_at DESC;

-- transactions 테이블
SELECT
  id,
  user_id,
  type, -- 'usage'
  amount, -- 25, 50, 100
  description, -- '메시지 발송 (SMS/LMS/MMS)'
  metadata, -- { usage_type: 'message_send', message_type: '...' }
  created_at
FROM transactions
WHERE user_id = YOUR_USER_ID
AND type = 'usage'
ORDER BY created_at DESC;
```

### 🎯 핵심 테스트 시나리오 (완료)

#### 시나리오 1.1: SMS 발송 (짧은 메시지)
**입력:**
- 수신자: 01012345678
- 메시지: "안녕하세요"
- 이미지: 없음

**예상 결과:**
- ✅ 메시지 타입: SMS (자동 판단)
- ✅ 잔액 차감: 25원
- ✅ MTS API 요청 데이터: subject 필드 없음
- ✅ DB 저장: message_type='SMS', credit_used=25

#### 시나리오 1.2: LMS 발송 (긴 메시지)
**입력:**
- 수신자: 01012345678
- 메시지: "안녕하세요 고객님, 예약이 정상적으로 완료되었습니다. 추가 문의사항이 있으시면 언제든지 연락주세요."
- 이미지: 없음

**예상 결과:**
- ✅ 메시지 타입: LMS (자동 판단, 93바이트 초과)
- ✅ 잔액 차감: 50원
- ✅ MTS API 요청 데이터: subject="LMS" 자동 추가
- ✅ DB 저장: message_type='LMS', credit_used=50

#### 시나리오 1.3: MMS 발송 (이미지 포함)
**입력:**
- 수신자: 01012345678
- 메시지: "이미지가 포함된 MMS입니다"
- 이미지: photo.png (1.2MB)

**예상 결과:**
- ✅ 이미지 최적화: 245KB (640×480px, JPEG)
- ✅ MTS 이미지 업로드: /2025/11/03/20251103052213575.jpg
- ✅ 메시지 타입: MMS (이미지 있으면 무조건 MMS)
- ✅ 잔액 차감: 100원
- ✅ MTS API 요청 데이터:
  ```json
  {
    "subject": "MMS",
    "attachment": {
      "image": [{
        "img_url": "/2025/11/03/20251103052213575.jpg"
      }]
    }
  }
  ```
- ✅ DB 저장: message_type='MMS', credit_used=100

### 📝 주요 Console.log 출력 (참고)

**SMS 발송 시:**
```
========================================
[MTS SMS API 호출 시작]
시간: 2025-11-03T05:22:45.123Z
API URL: https://api.mtsco.co.kr/sndng/sms/sendMessage
계산된 바이트: 15바이트
메시지 타입: SMS
요청 데이터: {
  "callback_number": "010****1234",
  "phone_number": "010****5678",
  "message": "안녕하세요"
}
// subject 없음 주목!
========================================
```

**LMS 발송 시:**
```
========================================
[MTS SMS API 호출 시작]
계산된 바이트: 93바이트
메시지 타입: LMS
요청 데이터: {
  "subject": "LMS",  // ⭐ LMS는 subject 필수!
  ...
}
========================================
```

**MMS 발송 시:**
```
========================================
[MTS 이미지 업로드 시작]
파일명: photo.png
원본크기: 1.2MB
최적화 후: 245KB (640x480px, JPEG)
이미지 URL: /2025/11/03/20251103052213575.jpg
========================================

[MTS SMS API 호출 시작]
메시지 타입: MMS
이미지 포함: Yes
요청 데이터: {
  "subject": "MMS",
  "attachment": {
    "image": [{
      "img_url": "/2025/11/03/20251103052213575.jpg"
    }]
  }
}
========================================
```

### ⚠️ 알려진 이슈 (비차단)

**ER17 에러: NotAllowedCallbackNumber**
- 원인: 발신번호가 MTS에 등록되지 않음
- 영향: 메시지 발송 실패 (API 응답은 정상)
- 해결: MTS 담당자에게 발신번호 등록 요청
- 상태: 요청 중

**중요**: 이 에러는 MTS 설정 문제이며, 코드 구현과는 무관합니다. API 호출, 데이터 저장, 잔액 차감은 모두 정상 작동합니다.

---

## Phase 3: 카카오 알림톡

### 📌 사전 조건
- [x] 카카오 발신프로필 등록 완료
- [x] 알림톡 템플릿 등록 및 승인 완료

### 📋 Phase 3 테스트 체크리스트

**3.1 알림톡 템플릿 조회**
- [x] 발신프로필 선택 시 템플릿 자동 로딩
- [x] 템플릿 목록 드롭다운 표시
- [x] 템플릿 선택 시 내용 미리보기 표시

**3.2 알림톡 발송**
- [x] 템플릿 변수 치환 입력
- [x] 발송 버튼 클릭
- [x] MTS API 응답 코드 `0000` 또는 `1000` 확인 (code: "0000")
- [x] DB 저장 확인 (message_logs)
- [x] 잔액 13원 차감 확인 (transactions)

**3.3 알림톡 → SMS 전환 발송**
- [ ] 전환 발송 설정 (SMS/LMS/MMS)
- [ ] 전환 메시지 입력
- [ ] metadata에 tran_type 저장 확인

**3.4 실제 메시지 수신 확인** ⚠️
- [ ] 카카오톡으로 메시지 수신 확인
- ❓ **문제**: API 응답 성공했으나 실제 수신 안 됨 → MTS 문의 필요

### 테스트 시나리오 3.1: 알림톡 발송 (템플릿 변수 치환)

**테스트 단계:**
1. "카카오/네이버 톡톡" 탭 → "알림톡" 서브 탭
2. Kakao Channel 선택 (발신프로필)
3. 템플릿 자동 로딩 확인
4. 템플릿 선택
5. 변수 치환 (#{고객명} → "홍길동")
6. 수신자 입력 (01012345678)
7. 발송 버튼 클릭

**예상 결과:**
- [x] MTS API Request 확인 (Network 탭)
- [x] MTS API Response 확인 (응답 코드 0000) ✅
- [x] DB 저장 확인 (message_type='KAKAO_ALIMTALK') ✅
- [x] 잔액 13원 차감 확인 ✅
- [ ] 실제 메시지 수신 확인 ❌ (API 성공, 실제 수신 안 됨 → MTS 문의)

**DB 확인:**
```sql
-- message_logs 확인
SELECT * FROM message_logs
WHERE user_id = YOUR_USER_ID
ORDER BY created_at DESC LIMIT 1;

-- transactions 확인
SELECT * FROM transactions
WHERE user_id = YOUR_USER_ID
ORDER BY created_at DESC LIMIT 1;
```

---

## Phase 4: 카카오 친구톡

### 📌 사전 조건
- [x] 카카오 발신프로필 등록 완료
- [x] 친구톡 발송 권한 획득

### 🔧 주요 변경사항 (v1.9 - 2025-11-04)
- **메시지 타입 자동 감지 기능 추가**: 이미지 첨부 여부에 따라 FT/FI 자동 선택
- **UI 개선**: 메시지 타입 선택 버튼 제거, 자동 감지 안내 추가
- **이미지 업로드 방식 변경**: URL 입력 → 파일 선택 방식 (SMS 탭과 동일)
- **이미지 업로드 UI**: Textarea 하단 이미지 버튼으로 토글 (메시지 보내기 탭 패턴 적용)
- **MTS 이미지 업로드 API 연동**: `/api/messages/upload-image` 엔드포인트 사용
- **이미지 미리보기 기능**: 썸네일, 파일명, 파일 크기 표시
- **Console 로그 추가**: `[친구톡] 메시지 타입 자동 감지: FT/FI` 메시지 출력
- **템플릿 생성 API 추가**: 네이버 톡톡 템플릿, 카카오 브랜드 메시지 템플릿 생성 기능 구현

### 📋 Phase 4 테스트 체크리스트

**4.1 텍스트형 친구톡 (자동 감지 - FT)** ✅ 완료 (2025-11-04)
- [x] 메시지 내용 입력 (이미지 없음 → 자동으로 FT 선택)
- [x] 광고 여부 선택 (N - 비광고)
- [x] 발송 버튼 클릭
- [x] MTS API 응답 코드 확인 (code: "0000")
- [x] DB 저장 확인
- [x] 잔액 20원 차감 확인
- [x] Console.log에서 "[친구톡] 메시지 타입 자동 감지: FT (텍스트형)" 확인

**4.2 이미지형 친구톡 (자동 감지 - FI)** ✅ 완료 (2025-11-04)
- [x] Textarea 하단 이미지 아이콘 버튼 클릭 → 이미지 업로드 섹션 토글
- [x] "이미지 선택" 버튼으로 JPG/PNG 파일 선택 (300KB 이하)
- [x] MTS 이미지 업로드 API 호출 및 fileId 저장
- [x] 이미지 미리보기 확인 (썸네일, 파일명, 크기)
- [x] 메시지 내용 입력 (치환문구 포함: #[이름], #[날짜])
- [x] 발송 버튼 클릭
- [x] Console.log에서 "[친구톡] 메시지 타입 자동 감지: FI (이미지형)" 확인
- [x] MTS API 응답 성공 (code: "0000", message: "1 MessageRegistComplete")

**4.3 광고형 친구톡**
- [ ] ad_flag='Y' 선택
- [ ] 광고 문구 포함 확인
- [ ] 발송 시간 제한 확인 (08:00-20:00)

**4.4 실제 메시지 수신 확인** ⚠️
- [ ] 카카오톡으로 친구톡 메시지 수신 확인
- ❓ **문제**: API 응답 성공했으나 실제 수신 안 됨 → MTS 문의 필요

### 테스트 시나리오 4.1: 텍스트형 친구톡 (자동 감지 - FT)

**테스트 단계:**
1. "카카오/네이버 톡톡" 탭 → "친구톡" 서브 탭
2. Kakao Channel 선택
3. **메시지 타입 자동 감지 안내 확인** (파란색 박스)
   - "이미지가 첨부되면 이미지형(FI)으로, 첨부되지 않으면 텍스트형(FT)으로 자동 선택됩니다."
4. 광고 여부: N
5. 메시지 내용 입력 (이미지 첨부 안 함)
6. 수신자 입력
7. 발송 버튼 클릭
8. **Browser Console 확인**: `[친구톡] 메시지 타입 자동 감지: FT (텍스트형)` 메시지 확인

**예상 결과:**
- [x] MTS API Request 확인 ✅
- [x] MTS API Response 확인 (응답 코드 0000) ✅
- [x] DB 저장 확인 (message_type='KAKAO_FRIENDTALK') ✅
- [x] Console.log 자동 감지 메시지 확인 ✅ (2025-11-04)
- [x] 잔액 20원 차감 확인 ✅
- [ ] 실제 메시지 수신 확인 ❌ (API 성공, 실제 수신 안 됨 → MTS 문의)

### 테스트 시나리오 4.2: 이미지형 친구톡 (자동 감지 - FI)

**테스트 단계:**
1. "카카오/네이버 톡톡" 탭 → "친구톡" 서브 탭
2. Kakao Channel 선택
3. 메시지 입력란 하단의 **이미지 아이콘 버튼** 클릭
   - 이미지 업로드 섹션이 토글되어 나타남
4. **"이미지 선택"** 버튼 클릭
5. 파일 선택 (JPG/PNG, 300KB 이하)
   - 자동으로 MTS 이미지 업로드 API 호출
   - 업로드 완료 후 썸네일 미리보기 표시
6. 메시지 내용 입력 (치환문구 사용 가능: #[이름], #[날짜] 등)
7. 광고 여부: N
8. 수신자 입력
9. 발송 버튼 클릭
10. **Browser Console 확인**: `[친구톡] 메시지 타입 자동 감지: FI (이미지형)` 메시지 확인

**예상 결과:**
- [x] 이미지 업로드 섹션 토글 동작 ✅ (2025-11-04)
- [x] MTS 이미지 업로드 API 성공 (`/api/messages/upload-image`) ✅
- [x] 이미지 미리보기 표시 (썸네일, 파일명, 파일 크기) ✅
- [x] Console.log 자동 감지 메시지: `FI (이미지형)` ✅
- [x] MTS API Request 확인 (imageUrls: ["fileId"]) ✅
- [x] MTS API Response 확인 (code: "0000", message: "1 MessageRegistComplete") ✅
- [x] DB 저장 확인 (message_type='KAKAO_FRIENDTALK') ✅
- [x] 잔액 차감 확인 ✅
- [ ] 실제 메시지 수신 확인 ⏸️ (추후 테스트)

**실제 테스트 결과 (2025-11-04 11:19:39):**
```json
{
  "메시지 타입": "FI (이미지형) - 자동 감지 성공",
  "이미지": "1개 업로드 완료",
  "치환문구": "#[이름], #[날짜]",
  "MTS API 응답": {
    "code": "0000",
    "received_at": "2025-11-04 11:19:39",
    "message": "1 MessageRegistComplete"
  }
}
```

---

## Phase 5: 네이버 톡톡

### 📌 사전 조건
- [ ] 네이버 톡톡 계정 등록
- [ ] 템플릿 등록 및 승인 완료

### 📋 Phase 5 테스트 체크리스트

**5.1 네이버 톡톡 발송**
- [ ] 네이버톡 ID 입력
- [ ] 템플릿 자동 로딩 확인
- [ ] 템플릿 선택
- [ ] 상품 코드 선택 (INFORMATION/BENEFIT/CARDINFO)
- [ ] 발송 확인
- [ ] 잔액 차감 확인 (스마트알림: 13원, 광고: 20원)

### 테스트 시나리오 5.1: 네이버 톡톡 발송

**테스트 단계:**
1. "카카오/네이버 톡톡" 탭 → "네이버" 서브 탭
2. 네이버톡 ID 입력
3. 템플릿 자동 로딩 확인
4. 템플릿 선택
5. 상품 코드 선택
   - INFORMATION: 스마트알림 (13원)
   - BENEFIT: 광고 (20원)
   - CARDINFO: 스마트알림 (13원)
6. 템플릿 변수 치환
7. 수신자 입력
8. 발송 버튼 클릭

**예상 결과:**
- [ ] MTS API Request 확인
- [ ] MTS API Response 확인
- [ ] DB 저장 확인 (message_type='NAVERTALK')
- [ ] 잔액 차감 확인 (상품 코드별)
- ⏸️ 실제 메시지 수신 확인 (추후 테스트)

---

## Phase 6: 카카오 브랜드 메시지

### 📌 사전 조건
- [ ] 카카오 브랜드 메시지 권한 획득
- [ ] 브랜드 템플릿 등록 및 승인 완료

### 🔧 주요 변경사항 (v1.7 - 2025-11-03)
- **구조 변경**: 수동 입력 방식 → 템플릿 선택 방식 (완료)
- **워크플로우**: 알림톡과 동일한 방식 적용
- **UI**: BrandTab.tsx 완전 재작성 (579줄, Rich UI 구조)
- **템플릿 조회**: fetchBrandTemplates() 함수 구현 완료
- **Rich UI**: 템플릿 미리보기, 원형 차트, 변수 치환 등 8개 섹션

### 📋 Phase 6 테스트 체크리스트

**6.0 브랜드 템플릿 조회**
- [ ] 발신프로필 선택 시 템플릿 자동 로딩
- [ ] 템플릿 목록 드롭다운 표시
- [ ] 8가지 메시지 타입 필터링 확인
  - TEXT, IMAGE, WIDE, WIDE_ITEM_LIST
  - CAROUSEL_FEED, COMMERCE, CAROUSEL_COMMERCE, PREMIUM_VIDEO
- [ ] 템플릿 선택 시 Template Preview 업데이트
- [ ] Rich UI 구조 8개 섹션 표시 확인

**6.1 브랜드 메시지 발송**
- [ ] 템플릿 선택
- [ ] 템플릿 내용 미리보기 확인
- [ ] 변수 치환 (있는 경우)
- [ ] SMS 백업 설정 (N/S/L/M)
- [ ] 발송 버튼 클릭
- [ ] MTS API 응답 코드 확인
- [ ] DB 저장 확인
- [ ] 잔액 20원 차감 확인

### 테스트 시나리오 6.0: 브랜드 템플릿 조회 기능

**목적**: 발신프로필 선택 시 브랜드 템플릿 자동 로딩 확인

**API 엔드포인트**: `/api/kakao/templates?senderKey={senderKey}`

**테스트 단계:**
1. "카카오/네이버 톡톡" 탭 → "브랜드 메시지" 서브 탭
2. Kakao Channel 섹션에서 발신프로필 선택
3. 템플릿 자동 로딩 확인
4. 드롭다운에서 템플릿 목록 확인

**예상 결과:**
- [ ] 발신프로필 선택 시 즉시 템플릿 로딩 시작
- [ ] 로딩 중 "템플릿 목록을 불러오는 중입니다..." 표시
- [ ] 템플릿 목록이 드롭다운에 표시됨
- [ ] 각 템플릿 항목: `템플릿명 (템플릿코드)`
- [ ] 승인된 템플릿만 표시
- [ ] 템플릿 없을 경우 "등록된 템플릿이 없습니다" 표시

**Rich UI 구조 확인:**
- [ ] 섹션 1: Kakao Channel + Brand Template 선택 (side by side)
- [ ] 섹션 2: Template Preview (8가지 형식 타입 버튼)
- [ ] 섹션 3: Template Info + Example Images
- [ ] 섹션 4: Total Recipients + Targeting (원형 차트)
- [ ] 섹션 5: Text Replacement (변수 치환)
- [ ] 섹션 6: SMS Backup Settings (N/S/L/M 버튼)
- [ ] 섹션 7: Recipient Information (건수 + 예상 금액)
- [ ] 섹션 8: Send Button

**템플릿 선택 시 동작 확인:**
- [ ] 템플릿 선택 시 Template Preview 섹션 업데이트
- [ ] 선택된 템플릿의 message_type에 해당하는 버튼 활성화
- [ ] Template Info 섹션에 템플릿 내용 표시 (읽기 전용)
- [ ] 템플릿에 변수가 있을 경우 Text Replacement 섹션 표시

### 테스트 시나리오 6.1: 텍스트형 브랜드 메시지 (TEXT)

**테스트 단계:**
1. "카카오/네이버 톡톡" 탭 → "브랜드 메시지" 서브 탭
2. 발신프로필 선택
3. 템플릿 선택 (TEXT 타입)
4. 템플릿 미리보기 확인
5. 변수 치환 (있는 경우)
6. SMS 백업 설정 (N/S/L/M)
7. 수신자 입력
8. 발송 버튼 클릭

**예상 결과:**
- [ ] MTS API Request 확인
- [ ] MTS API Response 확인 (응답 코드 0000/1000)
- [ ] DB 저장 확인 (message_type='BRAND_MESSAGE')
- [ ] 잔액 20원 차감 확인
- [ ] metadata에 template_code, message_type 저장 확인
- ⏸️ 실제 메시지 수신 확인 (추후 테스트)

---

## 최종 체크리스트

### ✅ SMS/LMS/MMS (완료)
- [x] SMS 발송 (90바이트 이하)
- [x] LMS 발송 (90바이트 초과)
- [x] MMS 이미지 업로드
- [x] MMS 발송 (이미지 포함)
- [x] 메시지 타입 자동 판단
- [x] 잔액 차감 (SMS: 25원, LMS: 50원, MMS: 100원)
- [x] DB 저장 (message_logs, transactions)

### ✅ 카카오 알림톡 (완료 - 부분 성공)
- [x] 템플릿 조회 기능
- [x] 변수 치환 발송
- [ ] 버튼 기능 (미테스트)
- [ ] SMS 전환 발송 (미테스트)
- [x] 잔액 13원 차감 확인
- [x] MTS API 응답 성공 (code: "0000")
- [ ] **실제 메시지 수신** ❌ (MTS 문의 필요)

### ✅ 카카오 친구톡 (완료 - 부분 성공)
- [x] 텍스트형 (FT) - 비광고
- [ ] 이미지형 (FI) (미테스트)
- [ ] 와이드형 (FW) (미테스트)
- [ ] 광고형 (ad_flag=Y) (미테스트)
- [x] 잔액 20원 차감 확인
- [x] MTS API 응답 성공 (code: "0000")
- [ ] **실제 메시지 수신** ❌ (MTS 문의 필요)

### ✅ 네이버 톡톡 (중요)
- [ ] 템플릿 조회
- [ ] 스마트알림 발송 (13원)
- [ ] 광고 발송 (20원)
- [ ] 상품 코드별 요금 확인

### ✅ 카카오 브랜드 메시지 (필수)
- [ ] 템플릿 조회 기능
- [ ] Rich UI 8개 섹션 확인
- [ ] 텍스트형 발송
- [ ] 이미지형 발송
- [ ] 잔액 20원 차감 확인

---

## 테스트 결과 기록 양식

### Phase 1-2: SMS/LMS/MMS
```
테스트 일시: 2025-11-03
테스터: 개발팀
결과: [x] 성공 [ ] 실패
비고:
  - SMS/LMS 자동 판단 로직 정상 작동
  - MMS 이미지 업로드 완료 (PNG → JPEG, 640×480px, 300KB)
  - 잔액 차감 확인 (SMS: 25원, LMS: 50원, MMS: 100원)
  - DB 저장 확인 (message_logs, transactions)
  - ER17 에러 발생 (발신번호 미등록, MTS 설정 대기중)
```

### Phase 3: 카카오 알림톡
```
테스트 일시: 2025-11-03 17:43:40
테스터: 개발팀
결과: [x] 성공 [ ] 실패
비고:
  ✅ 템플릿 조회 및 선택 정상 작동
  ✅ 변수 치환 정상 작동 (#{고객명})
  ✅ MTS API 호출 성공 (code: "0000")
  ✅ API 응답: "1 MessageRegistComplete"
  ✅ message_logs 테이블 저장 확인
  ✅ transactions 테이블 저장 확인
  ✅ 잔액 13원 차감 확인
  ⏸️ 실제 카카오톡 수신 확인 (추후)

  발송 정보:
  - 템플릿: TEST_INSPECT_002
  - 발신프로필: 3916c974ec435ff7a86894ab839b4e8728237435
  - 수신번호: 010****1331
```

### Phase 4: 카카오 친구톡
```
테스트 일시: 2025-11-04 09:14:33
테스터: 개발팀
결과: [x] 성공 [ ] 실패
비고:
  ✅ 텍스트형 친구톡 (FT) 발송 성공
  ✅ 메시지 타입: FT, 광고 여부: N
  ✅ MTS API 호출 성공 (code: "0000")
  ✅ API 응답: "1 MessageRegistComplete"
  ✅ message_logs 테이블 저장 확인
  ✅ transactions 테이블 저장 확인
  ✅ 잔액 20원 차감 확인
  ❌ 실제 카카오톡 수신 안 됨 (알림톡과 동일한 현상)
  ⏸️ 이미지형(FI), 와이드형(FW), 광고형 미테스트

  발송 정보:
  - API 엔드포인트: /v2/sndng/ftk/sendMessage
  - 발신프로필: 3916c974ec435ff7a86894ab839b4e8728237435
  - 수신번호: 010****1331
  - messageType: FT
  - ad_flag: N
```

### Phase 5: 네이버 톡톡
```
테스트 일시:
테스터:
결과: [ ] 성공 [ ] 실패
비고:
```

### Phase 6: 카카오 브랜드 메시지
```
테스트 일시:
테스터:
결과: [ ] 성공 [ ] 실패
비고:
```

---

## 참고 문서

- [MTS_API_전환_통합_가이드.md](./MTS_API_전환_통합_가이드.md)
- [MTS_API_사용_현황_템플릿.txt](./MTS_API_사용_현황_템플릿.txt)
- [MTS_API_코드_위치_안내.txt](./MTS_API_코드_위치_안내.txt)

---

**문서 버전**: v1.7
**작성**: 2025-11-03
**다음 업데이트 예정**: 테스트 완료 후
