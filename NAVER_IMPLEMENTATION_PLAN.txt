================================================================================
ë„¤ì´ë²„ í†¡í†¡ ë©”ì‹œì§€ ë°œì†¡ ê¸°ëŠ¥ êµ¬í˜„ ê³„íšì„œ (ìƒì„¸)
================================================================================
ì‘ì„±ì¼: 2025-10-15
ëŒ€ìƒ: ë„¤ì´ë²„ í†¡í†¡ (ìŠ¤ë§ˆíŠ¸ì•Œë¦¼)
êµ¬í˜„ ë°©ì‹: ì§ì ‘ ì—°ë™ (ë„¤ì´ë²„ í†¡í†¡ íŒŒíŠ¸ë„ˆ API)


================================================================================
ëª©ì°¨
================================================================================
1. ë„¤ì´ë²„ í†¡í†¡ íŒŒíŠ¸ë„ˆ ê³„ì • ì¤€ë¹„
2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
3. API ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„
4. ë‹¨ê³„ë³„ êµ¬í˜„ ê³„íš
5. ìŠ¤ë§ˆíŠ¸ì•Œë¦¼ êµ¬í˜„ ìƒì„¸
6. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
7. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…


================================================================================
1. ë„¤ì´ë²„ í†¡í†¡ íŒŒíŠ¸ë„ˆ ê³„ì • ì¤€ë¹„
================================================================================

1.1 í•„ìˆ˜ ì¤€ë¹„ ì‚¬í•­
-----------------
âš ï¸ êµ¬í˜„ ì‹œì‘ ì „ ë°˜ë“œì‹œ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤!

[ ] ë„¤ì´ë²„ í†¡í†¡ íŒŒíŠ¸ë„ˆ ê°€ì… (https://partner.talk.naver.com/)
    â””â”€ ì‚¬ì—…ì ë“±ë¡ì¦ í•„ìš”
    â””â”€ ëŒ€í‘œì ë³¸ì¸ ì¸ì¦

[ ] í†¡í†¡ ì„œë¹„ìŠ¤ ìƒì„±
    â””â”€ íŒŒíŠ¸ë„ˆì„¼í„° > ì„œë¹„ìŠ¤ ê´€ë¦¬ > ì„œë¹„ìŠ¤ ë§Œë“¤ê¸°
    â””â”€ ì„œë¹„ìŠ¤ëª…, ì¹´í…Œê³ ë¦¬ ì„¤ì •
    â””â”€ Talk ID ì„¤ì •

[ ] ìŠ¤ë§ˆíŠ¸ì•Œë¦¼ í…œí”Œë¦¿ ë“±ë¡
    â””â”€ ì„œë¹„ìŠ¤ ê´€ë¦¬ > ìŠ¤ë§ˆíŠ¸ì•Œë¦¼ > í…œí”Œë¦¿ ë“±ë¡
    â””â”€ í…œí”Œë¦¿ ë‚´ìš© ì‘ì„±
    â””â”€ ë³€ìˆ˜ ì„¤ì •


1.2 í•„ìš”í•œ ì •ë³´ ìˆ˜ì§‘
------------------
êµ¬í˜„ì— í•„ìš”í•œ ê°’ë“¤ì„ ë¯¸ë¦¬ ì¤€ë¹„í•˜ì„¸ìš”:

âœ… Partner Key (íŒŒíŠ¸ë„ˆ API í‚¤)
   ìœ„ì¹˜: íŒŒíŠ¸ë„ˆì„¼í„° > ì„¤ì • > API ê´€ë¦¬ > Partner Key
   ì˜ˆì‹œ: abc123def456

âœ… Secret Key
   ìœ„ì¹˜: íŒŒíŠ¸ë„ˆì„¼í„° > ì„¤ì • > API ê´€ë¦¬ > Secret Key
   ì˜ˆì‹œ: xyz789uvw012

âœ… Service ID
   ìœ„ì¹˜: ì„œë¹„ìŠ¤ ê´€ë¦¬ > ì„œë¹„ìŠ¤ ìƒì„¸ > ì„œë¹„ìŠ¤ ID
   ì˜ˆì‹œ: service_12345

âœ… Talk ID
   ìœ„ì¹˜: ì„œë¹„ìŠ¤ ê´€ë¦¬ > ì„œë¹„ìŠ¤ ìƒì„¸ > Talk ID
   ì˜ˆì‹œ: @mytalk

âœ… í…œí”Œë¦¿ ì½”ë“œ
   ìœ„ì¹˜: ìŠ¤ë§ˆíŠ¸ì•Œë¦¼ > í…œí”Œë¦¿ ê´€ë¦¬ > í…œí”Œë¦¿ ì½”ë“œ
   ì˜ˆì‹œ: template_001


1.3 í™˜ê²½ë³€ìˆ˜ ì„¤ì •
----------------
.env.localì— ì¶”ê°€:

```env
# ===== ë„¤ì´ë²„ í†¡í†¡ =====
NAVER_TALKTALK_API_KEY=abc123def456
NAVER_TALKTALK_SECRET_KEY=xyz789uvw012
NAVER_TALKTALK_PARTNER_ID=your_partner_id
NAVER_TALKTALK_SERVICE_ID=service_12345
NAVER_TALKTALK_API_URL=https://talk.naver.com/api/v1
```


1.4 ë„¤ì´ë²„ í†¡í†¡ íŠ¹ì§•
------------------
âœ… ì•Œë¦¼í†¡ê³¼ ìœ ì‚¬í•œ êµ¬ì¡°
âœ… í…œí”Œë¦¿ ì‚¬ì „ ë“±ë¡ í•„ìš”
âœ… ë°œì†¡ ë‹¨ê°€ ì €ë ´ (6-10ì›)
âœ… ë„¤ì´ë²„ ì•± í‘¸ì‹œ ì•Œë¦¼
âœ… ë„¤ì´ë²„ ì‚¬ìš©ìì—ê²Œë§Œ ë„ë‹¬


================================================================================
2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
================================================================================

2.1 naver_talk_services (ë„¤ì´ë²„ í†¡í†¡ ì„œë¹„ìŠ¤)
------------------------------------------
```sql
CREATE TABLE naver_talk_services (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  partner_id VARCHAR(100),                        -- íŒŒíŠ¸ë„ˆ ID
  service_id VARCHAR(100) UNIQUE,                 -- ì„œë¹„ìŠ¤ ID
  service_name VARCHAR(200),                      -- ì„œë¹„ìŠ¤ëª…
  talk_id VARCHAR(100),                           -- Talk ID (@mytalk)
  unique_id VARCHAR(100),                         -- ê³ ìœ  ID
  category VARCHAR(50),                           -- ì¹´í…Œê³ ë¦¬
  status VARCHAR(20) DEFAULT 'active',            -- 'active', 'inactive'
  linked_at TIMESTAMP,                            -- ì—°ë™ì¼
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_naver_services_user_id ON naver_talk_services(user_id);
CREATE INDEX idx_naver_services_status ON naver_talk_services(status);
```


2.2 naver_talk_templates (ë„¤ì´ë²„ í†¡í†¡ í…œí”Œë¦¿)
--------------------------------------------
```sql
CREATE TABLE naver_talk_templates (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  service_id INTEGER REFERENCES naver_talk_services(id),
  template_id VARCHAR(100),                       -- ë„¤ì´ë²„ í…œí”Œë¦¿ ID
  template_code VARCHAR(100),                     -- í…œí”Œë¦¿ ì½”ë“œ
  template_name VARCHAR(200) NOT NULL,            -- í…œí”Œë¦¿ ì´ë¦„
  template_content TEXT NOT NULL,                 -- í…œí”Œë¦¿ ë‚´ìš©
  template_variables JSONB DEFAULT '[]',          -- ë³€ìˆ˜ ëª©ë¡
  button_count INTEGER DEFAULT 0,                 -- ë²„íŠ¼ ìˆ˜
  buttons JSONB DEFAULT '[]',                     -- ë²„íŠ¼ ì •ë³´
  status VARCHAR(20) DEFAULT 'active',            -- 'active', 'inactive', 'pending'
  is_hidden BOOLEAN DEFAULT false,                -- ìˆ¨ê¹€ ì—¬ë¶€
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_naver_templates_user_id ON naver_talk_templates(user_id);
CREATE INDEX idx_naver_templates_service_id ON naver_talk_templates(service_id);
CREATE INDEX idx_naver_templates_status ON naver_talk_templates(status);
```


2.3 naver_talk_message_logs (ë„¤ì´ë²„ í†¡í†¡ ë°œì†¡ ë¡œê·¸)
--------------------------------------------------
```sql
CREATE TABLE naver_talk_message_logs (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  service_id INTEGER REFERENCES naver_talk_services(id),
  template_id INTEGER REFERENCES naver_talk_templates(id),
  to_number VARCHAR(20) NOT NULL,
  to_name VARCHAR(100),
  message_content TEXT NOT NULL,
  template_variables JSONB,                       -- ì‹¤ì œ ì¹˜í™˜ëœ ë³€ìˆ˜ê°’
  sent_at TIMESTAMP,
  status VARCHAR(20) NOT NULL,                    -- 'sent', 'failed', 'pending'
  error_message TEXT,
  credit_used INTEGER,
  fallback_to_sms BOOLEAN DEFAULT false,
  metadata JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_naver_logs_user_id ON naver_talk_message_logs(user_id);
CREATE INDEX idx_naver_logs_sent_at ON naver_talk_message_logs(sent_at);
CREATE INDEX idx_naver_logs_status ON naver_talk_message_logs(status);
```


================================================================================
3. API ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„
================================================================================

3.1 ì„œë¹„ìŠ¤ ê´€ë¦¬ API
------------------

ğŸ“ POST /api/naver-talk/services
ì„¤ëª…: ë„¤ì´ë²„ í†¡í†¡ ì„œë¹„ìŠ¤ ë“±ë¡
ìš”ì²­:
```json
{
  "partnerId": "your_partner_id",
  "serviceId": "service_12345",
  "serviceName": "ìš°ë¦¬ íšŒì‚¬ í†¡í†¡",
  "talkId": "@mytalk"
}
```
ì‘ë‹µ:
```json
{
  "success": true,
  "service": {
    "id": 1,
    "serviceId": "service_12345",
    "serviceName": "ìš°ë¦¬ íšŒì‚¬ í†¡í†¡",
    "talkId": "@mytalk",
    "status": "active"
  }
}
```

ğŸ“ GET /api/naver-talk/services
ì„¤ëª…: ë„¤ì´ë²„ í†¡í†¡ ì„œë¹„ìŠ¤ ëª©ë¡
ì‘ë‹µ:
```json
{
  "services": [
    {
      "id": 1,
      "serviceId": "service_12345",
      "serviceName": "ìš°ë¦¬ íšŒì‚¬ í†¡í†¡",
      "talkId": "@mytalk",
      "linkedAt": "2025-10-15T10:00:00Z"
    }
  ],
  "total": 1
}
```

ğŸ“ DELETE /api/naver-talk/services/:id
ì„¤ëª…: ì„œë¹„ìŠ¤ ì‚­ì œ


3.2 í…œí”Œë¦¿ ê´€ë¦¬ API
------------------

ğŸ“ POST /api/naver-talk/templates
ì„¤ëª…: ë„¤ì´ë²„ í…œí”Œë¦¿ ë“±ë¡
ìš”ì²­:
```json
{
  "serviceId": 1,
  "templateCode": "template_001",
  "templateName": "ë°°ì†¡ ì•Œë¦¼",
  "templateContent": "#{ê³ ê°ëª…}ë‹˜, ì£¼ë¬¸í•˜ì‹  ìƒí’ˆì´ #{ì‹œê°„}ì— ë°°ì†¡ë©ë‹ˆë‹¤.",
  "templateVariables": [
    {"name": "ê³ ê°ëª…", "type": "string"},
    {"name": "ì‹œê°„", "type": "string"}
  ],
  "buttons": [
    {"name": "ë°°ì†¡ì¡°íšŒ", "type": "link", "url": "https://example.com/track"}
  ]
}
```

ğŸ“ GET /api/naver-talk/templates
ì„¤ëª…: í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ
ì¿¼ë¦¬: ?serviceId=1&status=active&search=ê²€ìƒ‰ì–´&showHidden=true

ğŸ“ PATCH /api/naver-talk/templates/:id
ì„¤ëª…: í…œí”Œë¦¿ ìˆ¨ê¹€/í‘œì‹œ í† ê¸€
ìš”ì²­:
```json
{
  "isHidden": true
}
```

ğŸ“ DELETE /api/naver-talk/templates/:id
ì„¤ëª…: í…œí”Œë¦¿ ì‚­ì œ


3.3 ë©”ì‹œì§€ ë°œì†¡ API
------------------

ğŸ“ POST /api/naver-talk/send
ì„¤ëª…: ë„¤ì´ë²„ ìŠ¤ë§ˆíŠ¸ì•Œë¦¼ ë°œì†¡
ìš”ì²­:
```json
{
  "serviceId": 1,
  "templateCode": "template_001",
  "recipients": [
    {
      "phone_number": "01012345678",
      "name": "í™ê¸¸ë™",
      "variables": {
        "ê³ ê°ëª…": "í™ê¸¸ë™",
        "ì‹œê°„": "14:00"
      }
    }
  ],
  "fallbackToSms": true
}
```
ì‘ë‹µ:
```json
{
  "success": true,
  "results": [
    {
      "recipient": "01012345678",
      "success": true,
      "messageId": "msg_naver_123456"
    }
  ]
}
```


================================================================================
4. ë‹¨ê³„ë³„ êµ¬í˜„ ê³„íš
================================================================================

Week 1: ì„œë¹„ìŠ¤ ë° í…œí”Œë¦¿ ê´€ë¦¬
-----------------------------
Day 1-2:
[ ] DB ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„± (3ê°œ í…Œì´ë¸”)
[ ] Supabaseì— í…Œì´ë¸” ìƒì„± ë° RLS ì •ì±… ì„¤ì •
[ ] ë„¤ì´ë²„ í†¡í†¡ API í´ë¼ì´ì–¸íŠ¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‘ì„±
    â””â”€ src/lib/naver-talk-api.ts

Day 3-4:
[ ] POST /api/naver-talk/services êµ¬í˜„
[ ] GET /api/naver-talk/services êµ¬í˜„
[ ] DELETE /api/naver-talk/services/:id êµ¬í˜„
[ ] NaverTalkIdTab UI ì—°ë™
    â””â”€ ì„œë¹„ìŠ¤ ëª©ë¡ ë Œë”ë§
    â””â”€ í˜ì´ì§€ë„¤ì´ì…˜

Day 5:
[ ] POST /api/naver-talk/templates êµ¬í˜„
[ ] GET /api/naver-talk/templates êµ¬í˜„
[ ] PATCH /api/naver-talk/templates/:id (ìˆ¨ê¹€ í† ê¸€)
[ ] DELETE /api/naver-talk/templates/:id êµ¬í˜„


Week 2: ë°œì†¡ ê¸°ëŠ¥ ë° UI ì—°ë™
---------------------------
Day 1-2:
[ ] NaverTemplateTab UI ì—°ë™
    â””â”€ ê²€ìƒ‰ í•„í„° (ì—ì´ì „íŠ¸, ìƒíƒœ, ì´ë¦„, ID)
    â””â”€ "ìˆ¨ê¸´ í…œí”Œë¦¿ ë³´ê¸°" ì²´í¬ë°•ìŠ¤
    â””â”€ í…œí”Œë¦¿ ìƒì„± ëª¨ë‹¬
    â””â”€ í…œí”Œë¦¿ ëª©ë¡ ë° í˜ì´ì§€ë„¤ì´ì…˜

Day 3-4:
[ ] POST /api/naver-talk/send êµ¬í˜„
    â””â”€ í…œí”Œë¦¿ ì¡°íšŒ
    â””â”€ ë³€ìˆ˜ ì¹˜í™˜
    â””â”€ ë„¤ì´ë²„ API í˜¸ì¶œ
    â””â”€ ë¡œê·¸ ì €ì¥
    â””â”€ ëŒ€ì²´ë°œì†¡ (SMS fallback)

Day 5:
[ ] NaverTalkContent UI ì—°ë™
    â””â”€ ë„¤ì´ë²„í†¡ ì„ íƒ ë“œë¡­ë‹¤ìš´
    â””â”€ í…œí”Œë¦¿ ì„ íƒ ë“œë¡­ë‹¤ìš´
    â””â”€ í…œí”Œë¦¿ ë‚´ìš© ìë™ ë¡œë“œ (ì½ê¸°ì „ìš©)
    â””â”€ ë³€ìˆ˜ ì¹˜í™˜ ë¡œì§
[ ] í†µí•© í…ŒìŠ¤íŠ¸


================================================================================
5. ìŠ¤ë§ˆíŠ¸ì•Œë¦¼ êµ¬í˜„ ìƒì„¸
================================================================================

5.1 ìŠ¤ë§ˆíŠ¸ì•Œë¦¼ íŠ¹ì§•
------------------
âœ… ì•Œë¦¼í†¡ê³¼ ìœ ì‚¬í•œ êµ¬ì¡°
âœ… í…œí”Œë¦¿ ì‚¬ì „ ë“±ë¡ í•„ìš”
âœ… í…œí”Œë¦¿ ë‚´ìš© ìˆ˜ì • ë¶ˆê°€ (ë³€ìˆ˜ ì¹˜í™˜ë§Œ)
âœ… ë°œì†¡ ë‹¨ê°€ ì €ë ´
âœ… ë„¤ì´ë²„ ì•± í‘¸ì‹œ
âœ… ìˆ˜ì‹ ê±°ë¶€ ê¸°ëŠ¥


5.2 í…œí”Œë¦¿ ë“±ë¡ ì ˆì°¨
-------------------
1. ë„¤ì´ë²„ í†¡í†¡ íŒŒíŠ¸ë„ˆì„¼í„° ë¡œê·¸ì¸
2. ì„œë¹„ìŠ¤ ê´€ë¦¬ > ìŠ¤ë§ˆíŠ¸ì•Œë¦¼ > í…œí”Œë¦¿ ë“±ë¡
3. í…œí”Œë¦¿ ë‚´ìš© ì‘ì„±
   - ë³€ìˆ˜: #{ë³€ìˆ˜ëª…} í˜•ì‹
   - ìµœëŒ€ 1,000ì
4. ë²„íŠ¼ ì¶”ê°€ (ì„ íƒì‚¬í•­)
5. í…œí”Œë¦¿ ì €ì¥
6. í…œí”Œë¦¿ ì½”ë“œ ìë™ ë°œê¸‰


5.3 ë°œì†¡ API êµ¬í˜„ ì˜ˆì‹œ
---------------------
src/app/api/naver-talk/send/route.ts

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { createClient } from '@supabase/supabase-js';
import { verifyToken } from '@/lib/auth';
import crypto from 'crypto';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
);

export async function POST(request: NextRequest) {
  try {
    // JWT ì¸ì¦
    const token = request.headers.get('Authorization')?.replace('Bearer ', '');
    const userId = await verifyToken(token);
    if (!userId) {
      return NextResponse.json({ error: 'ì¸ì¦ ì‹¤íŒ¨' }, { status: 401 });
    }

    const body = await request.json();
    const { serviceId, templateCode, recipients, fallbackToSms } = body;

    // ì„œë¹„ìŠ¤ ì¡°íšŒ
    const { data: service, error: serviceError } = await supabase
      .from('naver_talk_services')
      .select('*')
      .eq('id', serviceId)
      .eq('status', 'active')
      .single();

    if (serviceError || !service) {
      return NextResponse.json({ error: 'í™œì„±í™”ëœ ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤' }, { status: 400 });
    }

    // í…œí”Œë¦¿ ì¡°íšŒ
    const { data: template, error: templateError } = await supabase
      .from('naver_talk_templates')
      .select('*')
      .eq('template_code', templateCode)
      .eq('service_id', serviceId)
      .eq('status', 'active')
      .single();

    if (templateError || !template) {
      return NextResponse.json({ error: 'í™œì„±í™”ëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤' }, { status: 400 });
    }

    // ë„¤ì´ë²„ í†¡í†¡ API í˜¸ì¶œ
    const results = [];
    for (const recipient of recipients) {
      try {
        // ì¸ì¦ ì„œëª… ìƒì„±
        const timestamp = Date.now();
        const signature = generateSignature(timestamp);

        const response = await fetch(`${process.env.NAVER_TALKTALK_API_URL}/messages/send`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Partner-Key': process.env.NAVER_TALKTALK_API_KEY!,
            'X-Timestamp': timestamp.toString(),
            'X-Signature': signature
          },
          body: JSON.stringify({
            serviceId: service.service_id,
            templateCode: templateCode,
            recipientNo: recipient.phone_number,
            parameters: recipient.variables
          })
        });

        const data = await response.json();
        const success = response.ok && data.code === '0000';

        results.push({
          recipient: recipient.phone_number,
          success: success,
          messageId: success ? data.messageId : null
        });

        // ë¡œê·¸ ì €ì¥
        await supabase.from('naver_talk_message_logs').insert({
          user_id: userId,
          service_id: serviceId,
          template_id: template.id,
          to_number: recipient.phone_number,
          to_name: recipient.name,
          message_content: template.template_content,
          template_variables: recipient.variables,
          status: success ? 'sent' : 'failed',
          error_message: success ? null : data.message,
          credit_used: 8 // ë„¤ì´ë²„ í†¡í†¡ ë‹¨ê°€
        });

        // ëŒ€ì²´ë°œì†¡ (ì‹¤íŒ¨ ì‹œ)
        if (!success && fallbackToSms) {
          await sendFallbackSms(recipient, template.template_content);
        }

      } catch (error) {
        results.push({
          recipient: recipient.phone_number,
          success: false
        });
      }
    }

    return NextResponse.json({ success: true, results });
  } catch (error) {
    console.error('ë„¤ì´ë²„ í†¡í†¡ ë°œì†¡ ì˜¤ë¥˜:', error);
    return NextResponse.json({ error: 'ë°œì†¡ ì‹¤íŒ¨' }, { status: 500 });
  }
}

// ë„¤ì´ë²„ API ì¸ì¦ ì„œëª… ìƒì„±
function generateSignature(timestamp: number): string {
  const message = `${timestamp}.${process.env.NAVER_TALKTALK_API_KEY}`;
  const hmac = crypto.createHmac('sha256', process.env.NAVER_TALKTALK_SECRET_KEY!);
  return hmac.update(message).digest('base64');
}

async function sendFallbackSms(recipient: any, content: string) {
  // SMS ë°œì†¡ ë¡œì§ (ê¸°ì¡´ Naver SENS API ì‚¬ìš©)
  // TODO: êµ¬í˜„
}
```


5.4 ë³€ìˆ˜ ì¹˜í™˜ ë¡œì§
-----------------
ë„¤ì´ë²„ í†¡í†¡ë„ ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ê³¼ ë™ì¼í•˜ê²Œ #{ë³€ìˆ˜ëª…} í˜•ì‹ ì‚¬ìš©:

```typescript
function replaceVariables(template: string, variables: Record<string, string>) {
  let result = template;
  Object.entries(variables).forEach(([key, value]) => {
    const regex = new RegExp(`#{${key}}`, 'g');
    result = result.replace(regex, value);
  });
  return result;
}

// ì‚¬ìš© ì˜ˆì‹œ
const templateContent = "#{ê³ ê°ëª…}ë‹˜, ì˜ˆì•½ì´ #{ë‚ ì§œ} #{ì‹œê°„}ì— í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.";
const variables = { "ê³ ê°ëª…": "í™ê¸¸ë™", "ë‚ ì§œ": "10ì›” 20ì¼", "ì‹œê°„": "14:00" };
const finalMessage = replaceVariables(templateContent, variables);
// ê²°ê³¼: "í™ê¸¸ë™ë‹˜, ì˜ˆì•½ì´ 10ì›” 20ì¼ 14:00ì— í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤."
```


5.5 í…œí”Œë¦¿ ìˆ¨ê¹€ ì²˜ë¦¬
-------------------
ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì§€ ì•Šê³  ìˆ¨ê¹€ ì²˜ë¦¬:

```typescript
// PATCH /api/naver-talk/templates/:id
export async function PATCH(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const body = await request.json();
    const { isHidden } = body;

    const { data, error } = await supabase
      .from('naver_talk_templates')
      .update({ is_hidden: isHidden, updated_at: new Date() })
      .eq('id', params.id)
      .select()
      .single();

    if (error) throw error;

    return NextResponse.json({ success: true, template: data });
  } catch (error) {
    return NextResponse.json({ error: 'ì—…ë°ì´íŠ¸ ì‹¤íŒ¨' }, { status: 500 });
  }
}
```


================================================================================
6. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
================================================================================

6.1 ì„œë¹„ìŠ¤ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
---------------------
[ ] ì™¸ë¶€ ë§í¬ ë²„íŠ¼ í´ë¦­ í™•ì¸
   â””â”€ "ë„¤ì´ë²„í†¡í†¡ ì—°ë™ë°©ë²• â†—"
   â””â”€ "ë„¤ì´ë²„ í†¡í†¡ íŒŒíŠ¸ë„ˆì„¼í„° â†—"
[ ] ì„œë¹„ìŠ¤ ë“±ë¡ API í…ŒìŠ¤íŠ¸
[ ] ì„œë¹„ìŠ¤ ëª©ë¡ ì¡°íšŒ
[ ] ì„œë¹„ìŠ¤ ì •ë³´ í‘œì‹œ í™•ì¸
   â””â”€ í†¡ ì´ë¦„, Talk ID, ê³ ìœ  ID, ì—°ë™ì¼
[ ] í˜ì´ì§€ë„¤ì´ì…˜ ë™ì‘ í™•ì¸
[ ] ì„œë¹„ìŠ¤ ì‚­ì œ í…ŒìŠ¤íŠ¸


6.2 í…œí”Œë¦¿ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
---------------------
[ ] ê²€ìƒ‰ í•„í„° í…ŒìŠ¤íŠ¸
   â””â”€ ì—°ë™ ì—ì´ì „íŠ¸ ì„ íƒ
   â””â”€ í…œí”Œë¦¿ ìƒíƒœ í•„í„°
   â””â”€ í…œí”Œë¦¿ ì´ë¦„ ê²€ìƒ‰
   â””â”€ í…œí”Œë¦¿ ID ê²€ìƒ‰
   â””â”€ "ìˆ¨ê¸´ í…œí”Œë¦¿ ë³´ê¸°" ì²´í¬ë°•ìŠ¤
[ ] í…œí”Œë¦¿ ìƒì„± ëª¨ë‹¬ í…ŒìŠ¤íŠ¸
[ ] í…œí”Œë¦¿ ë“±ë¡
[ ] í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ
[ ] í…œí”Œë¦¿ ìˆ¨ê¹€ ì²˜ë¦¬
[ ] í…œí”Œë¦¿ ì‚­ì œ


6.3 ë°œì†¡ í…ŒìŠ¤íŠ¸
--------------
[ ] NaverTalkContentì—ì„œ ë„¤ì´ë²„í†¡ ì„ íƒ
[ ] í…œí”Œë¦¿ ì„ íƒ
[ ] í…œí”Œë¦¿ ë‚´ìš© ìë™ ë¡œë“œ í™•ì¸
[ ] ë³€ìˆ˜ ì¹˜í™˜ ì •ë³´ í‘œì‹œ í™•ì¸
[ ] ìˆ˜ì‹ ë²ˆí˜¸ ì¶”ê°€
[ ] ë°œì†¡ í…ŒìŠ¤íŠ¸
[ ] ë°œì†¡ ë¡œê·¸ í™•ì¸
[ ] ë°œì†¡ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ë°œì†¡ í™•ì¸


6.4 í†µí•© í…ŒìŠ¤íŠ¸
--------------
[ ] ì—¬ëŸ¬ ì„œë¹„ìŠ¤ ë“±ë¡
[ ] ì—¬ëŸ¬ í…œí”Œë¦¿ ë“±ë¡
[ ] í…œí”Œë¦¿ ê²€ìƒ‰ ë° í•„í„°ë§
[ ] ëŒ€ëŸ‰ ë°œì†¡ (100ëª…)
[ ] ì—ëŸ¬ ì²˜ë¦¬ í™•ì¸
[ ] ë¡œê·¸ ì •ìƒ ì €ì¥ í™•ì¸


================================================================================
7. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
================================================================================

7.1 ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜
--------------------

âŒ "ì„œë¹„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
ì›ì¸: Service IDê°€ ì˜ëª»ë˜ì—ˆê±°ë‚˜ ë¹„í™œì„±í™”ë¨
í•´ê²°: íŒŒíŠ¸ë„ˆì„¼í„°ì—ì„œ Service ID í™•ì¸, ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸

âŒ "í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
ì›ì¸: í…œí”Œë¦¿ ì½”ë“œ ì˜¤íƒ€ ë˜ëŠ” ì‚­ì œë¨
í•´ê²°: íŒŒíŠ¸ë„ˆì„¼í„°ì—ì„œ í…œí”Œë¦¿ ì½”ë“œ ì¬í™•ì¸

âŒ "ì¸ì¦ ì‹¤íŒ¨ (Signature mismatch)"
ì›ì¸: Secret Keyê°€ ì˜ëª»ë˜ì—ˆê±°ë‚˜ ì„œëª… ìƒì„± ì˜¤ë¥˜
í•´ê²°: Secret Key ì¬í™•ì¸, íƒ€ì„ìŠ¤íƒ¬í”„ ë™ê¸°í™” í™•ì¸

âŒ "ë³€ìˆ˜ ê°’ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
ì›ì¸: í…œí”Œë¦¿ ë³€ìˆ˜ì™€ ì „ë‹¬í•œ ë³€ìˆ˜ ë¶ˆì¼ì¹˜
í•´ê²°: í…œí”Œë¦¿ì˜ #{ë³€ìˆ˜ëª…}ê³¼ ì „ë‹¬ ë³€ìˆ˜ëª… ì¼ì¹˜ í™•ì¸

âŒ "ë°œì†¡ ì‹¤íŒ¨ - ë„¤ì´ë²„ ì•± ë¯¸ì„¤ì¹˜"
ì›ì¸: ìˆ˜ì‹ ìê°€ ë„¤ì´ë²„ ì•±ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
í•´ê²°: SMS ëŒ€ì²´ë°œì†¡ í™œì„±í™”


7.2 ë””ë²„ê¹… íŒ
-------------
1. ë„¤ì´ë²„ í†¡í†¡ íŒŒíŠ¸ë„ˆì„¼í„° > ë°œì†¡ ë‚´ì—­ì—ì„œ ì‹¤íŒ¨ ì‚¬ìœ  í™•ì¸
2. ë°œì†¡ ë¡œê·¸ í…Œì´ë¸”ì—ì„œ error_message í™•ì¸
3. ë„¤ì´ë²„ API ì‘ë‹µ ì½”ë“œ ì°¸ê³ :
   - 0000: ì„±ê³µ
   - 1001: íŒŒë¼ë¯¸í„° ì˜¤ë¥˜
   - 2001: ì¸ì¦ ì‹¤íŒ¨
   - 3001: ì„œë¹„ìŠ¤ ë¯¸ë“±ë¡
   - 4001: í…œí”Œë¦¿ ë¯¸ë“±ë¡


7.3 ì„±ëŠ¥ ìµœì í™”
--------------
- ëŒ€ëŸ‰ ë°œì†¡ ì‹œ ë°°ì¹˜ ì²˜ë¦¬ (50ëª…ì”©)
- API í˜¸ì¶œ ì œí•œ ì¤€ìˆ˜ (ì´ˆë‹¹ ìµœëŒ€ 50ê±´)
- DB ì¿¼ë¦¬ ì¸ë±ìŠ¤ í™œìš©
- ì„œëª… ìºì‹± (ë™ì¼ íƒ€ì„ìŠ¤íƒ¬í”„ ì¬ì‚¬ìš© ê°€ëŠ¥, 60ì´ˆ ì´ë‚´)


7.4 ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
----------------
- Secret Key ì ˆëŒ€ ë…¸ì¶œ ê¸ˆì§€ (ì„œë²„ ì‚¬ì´ë“œë§Œ ì‚¬ìš©)
- ì„œëª… ìƒì„± ì‹œ íƒ€ì„ìŠ¤íƒ¬í”„ ê²€ì¦ (ì¬ìƒ ê³µê²© ë°©ì§€)
- API KeyëŠ” í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬
- HTTPS í•„ìˆ˜


================================================================================
ì²´í¬ë¦¬ìŠ¤íŠ¸
================================================================================

êµ¬í˜„ ì „:
--------
[ ] ë„¤ì´ë²„ í†¡í†¡ íŒŒíŠ¸ë„ˆ ê°€ì… ì™„ë£Œ
[ ] í†¡í†¡ ì„œë¹„ìŠ¤ ìƒì„± ì™„ë£Œ
[ ] Partner Key, Secret Key ë°œê¸‰ ì™„ë£Œ
[ ] Service ID í™•ë³´
[ ] í…œí”Œë¦¿ ìµœì†Œ 1ê°œ ë“±ë¡ ì™„ë£Œ
[ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ

êµ¬í˜„ ì¤‘:
--------
[ ] DB í…Œì´ë¸” 3ê°œ ìƒì„±
[ ] ì„œë¹„ìŠ¤ ê´€ë¦¬ API 3ê°œ êµ¬í˜„
[ ] í…œí”Œë¦¿ ê´€ë¦¬ API 4ê°œ êµ¬í˜„
[ ] ë°œì†¡ API êµ¬í˜„
[ ] ëŒ€ì²´ë°œì†¡ ë¡œì§ êµ¬í˜„
[ ] UI ì—°ë™ (2ê°œ ì»´í¬ë„ŒíŠ¸)

êµ¬í˜„ í›„:
--------
[ ] ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ í†µê³¼
[ ] ë°œì†¡ ë¡œê·¸ ì •ìƒ ì €ì¥ í™•ì¸
[ ] ëŒ€ì²´ë°œì†¡ ë™ì‘ í™•ì¸
[ ] ì—ëŸ¬ ì²˜ë¦¬ ê²€ì¦
[ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
[ ] ë¬¸ì„œí™”


================================================================================
ë¬¸ì„œ ë
================================================================================

â±ï¸ ì˜ˆìƒ êµ¬í˜„ ê¸°ê°„: 2ì£¼
ğŸ’° ì˜ˆìƒ ë¹„ìš©: ìŠ¤ë§ˆíŠ¸ì•Œë¦¼ 6-10ì›/ê±´
ğŸ“Œ ë‚œì´ë„: â­â­â­ (ì¤‘ê°„)
ğŸ“ ë¬¸ì˜: ë„¤ì´ë²„ ìŠ¤ë§ˆíŠ¸ì•Œë¦¼ ë°œì†¡ë°©ë²• ë° ìˆ˜ì‹ í™•ì¸ ë¬¸ì˜ - 1577-1603

================================================================================
