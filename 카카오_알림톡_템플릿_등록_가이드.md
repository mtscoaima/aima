# 카카오 알림톡 템플릿 등록 가이드

**작성일**: 2025-10-29
**대상**: MTS Message 사용자
**목적**: 카카오 알림톡 템플릿을 직접 등록하는 방법 안내

---

## 📋 템플릿 등록 프로세스 개요

```
1. 카카오 발신프로필 준비 (sender_key 필요)
   ↓
2. MTS 템플릿 등록 API 호출
   ↓
3. 카카오 검수 대기 (1~2일 소요)
   ↓
4. 승인 완료 후 사용 가능
```

---

## 1️⃣ 사전 준비사항

### ✅ 필수 정보
1. **카카오 발신프로필 키 (sender_key)**
   - 카카오톡 채널과 연결된 발신프로필 키
   - 예: `1a2b3c4d5e6f7g8h9i0j...`

2. **MTS 인증 코드 (auth_code)**
   - 현재 설정값: `7z12bG8oKXrMnHZcJBtycw==`
   - `.env` 파일에 이미 설정되어 있음

---

## 2️⃣ 템플릿 등록 방법

### 방법 A: MTS API 직접 호출 (권장)

#### Step 1: 발신프로필 키 확인

**API 엔드포인트**:
```
POST https://talks.mtsco.co.kr/mts/api/sender/list
```

**요청 예시** (Postman 또는 cURL):
```bash
curl -X POST "https://talks.mtsco.co.kr/mts/api/sender/list" \
  -H "Content-Type: application/json" \
  -d '{
    "auth_code": "7z12bG8oKXrMnHZcJBtycw==",
    "page": 1,
    "count": 100
  }'
```

**응답 예시**:
```json
{
  "code": "1000",
  "list": [
    {
      "sender_key": "1a2b3c4d5e6f...",
      "channel_name": "테스트 채널",
      "status": "active"
    }
  ]
}
```

👉 **`sender_key` 값을 복사해두세요!**

---

#### Step 2: 템플릿 등록

**API 엔드포인트**:
```
POST https://talks.mtsco.co.kr/mts/api/create/template
```

**최소 필수 파라미터**:
```json
{
  "senderKey": "발신프로필키",
  "templateCode": "TEST_TEMPLATE_001",
  "templateName": "테스트 템플릿",
  "templateMessageType": "BA",
  "templateEmphasizeType": "NONE",
  "templateContent": "안녕하세요!\n테스트 알림톡입니다.\n감사합니다."
}
```

**cURL 예시**:
```bash
curl -X POST "https://talks.mtsco.co.kr/mts/api/create/template" \
  -H "Content-Type: application/json" \
  -d '{
    "senderKey": "YOUR_SENDER_KEY",
    "templateCode": "TEST_TEMPLATE_001",
    "templateName": "테스트 알림톡",
    "templateMessageType": "BA",
    "templateEmphasizeType": "NONE",
    "templateContent": "안녕하세요!\n테스트 알림톡입니다.\n감사합니다."
  }'
```

**성공 응답**:
```json
{
  "code": "1000",
  "message": "템플릿 등록 성공"
}
```

---

### 방법 B: 카카오 비즈니스 관리자 페이지 (추천)

MTS API로 직접 등록하는 것보다 **카카오 비즈니스 관리자 페이지**를 사용하는 것이 더 편리합니다.

#### Step 1: 카카오 비즈니스 관리자 로그인
1. https://business.kakao.com/ 접속
2. 카카오톡 채널 계정으로 로그인

#### Step 2: 알림톡 템플릿 등록
1. 좌측 메뉴: **알림톡** → **템플릿 관리**
2. **템플릿 등록** 버튼 클릭
3. 템플릿 정보 입력:
   - **템플릿 코드**: `TEST_TEMPLATE_001` (영문, 숫자, _ 사용 가능, 30자 이내)
   - **템플릿 이름**: `테스트 알림톡`
   - **템플릿 카테고리**: 적절한 카테고리 선택
   - **템플릿 강조 유형**: 선택 안함 (NONE)
   - **템플릿 내용**:
     ```
     안녕하세요!
     테스트 알림톡입니다.
     감사합니다.
     ```

#### Step 3: 검수 요청
- 모든 정보 입력 완료 후 **등록** 버튼 클릭
- 카카오 검수팀이 검토 (보통 1~2일 소요)
- 승인 완료 시 이메일 또는 알림 수신

---

## 3️⃣ 템플릿 작성 가이드

### ✅ 기본 규칙
1. **최대 길이**: 1,000자
2. **줄바꿈**: `\n` 또는 실제 줄바꿈 사용 가능
3. **변수 사용**: `#{변수명}` 형식
   - 예: `#{고객명}님 안녕하세요!`
4. **특수문자**: 일부 제한 있음 (이모지 사용 가능)

### ✅ 템플릿 타입

| 타입 | 코드 | 설명 | 예시 |
|------|------|------|------|
| 기본형 | BA | 일반 텍스트만 | 주문 확인, 배송 알림 |
| 부가정보형 | EX | 추가 정보 포함 | 예약 상세 정보 |
| 채널추가형 | AD | 채널 추가 버튼 포함 | 프로모션 안내 |
| 복합형 | MI | 부가정보 + 채널추가 | 종합 안내 |

### ✅ 강조 유형

| 유형 | 코드 | 설명 |
|------|------|------|
| 선택 안함 | NONE | 일반 텍스트 |
| 강조 표기형 | TEXT | 제목/부제목 강조 |
| 이미지형 | IMAGE | 이미지 포함 |
| 아이템 리스트형 | ITEM_LIST | 항목 목록 표시 |

---

## 4️⃣ 템플릿 예시

### 예시 1: 기본 알림톡 (변수 없음)
```json
{
  "senderKey": "YOUR_SENDER_KEY",
  "templateCode": "SIMPLE_NOTIFICATION",
  "templateName": "간단 알림",
  "templateMessageType": "BA",
  "templateEmphasizeType": "NONE",
  "templateContent": "안녕하세요!\n\n테스트 알림톡입니다.\n\n감사합니다."
}
```

**발송 시 결과**:
```
안녕하세요!

테스트 알림톡입니다.

감사합니다.
```

---

### 예시 2: 변수 포함 알림톡
```json
{
  "senderKey": "YOUR_SENDER_KEY",
  "templateCode": "ORDER_CONFIRM",
  "templateName": "주문 확인",
  "templateMessageType": "BA",
  "templateEmphasizeType": "NONE",
  "templateContent": "#{고객명}님 안녕하세요!\n\n주문하신 상품이 #{배송상태} 상태입니다.\n송장번호: #{송장번호}\n\n감사합니다."
}
```

**발송 시 입력**:
- `고객명`: `홍길동`
- `배송상태`: `배송중`
- `송장번호`: `1234567890`

**발송 시 결과**:
```
홍길동님 안녕하세요!

주문하신 상품이 배송중 상태입니다.
송장번호: 1234567890

감사합니다.
```

---

### 예시 3: 버튼 포함 알림톡
```json
{
  "senderKey": "YOUR_SENDER_KEY",
  "templateCode": "ORDER_DETAIL",
  "templateName": "주문 상세",
  "templateMessageType": "BA",
  "templateEmphasizeType": "NONE",
  "templateContent": "주문이 완료되었습니다.\n\n주문번호: #{주문번호}\n상품명: #{상품명}\n\n아래 버튼을 클릭하여 상세 내용을 확인하세요.",
  "buttons": "[{\"name\":\"주문 확인\",\"linkType\":\"WL\",\"linkMo\":\"https://example.com/order/#{주문번호}\",\"linkPc\":\"https://example.com/order/#{주문번호}\"}]"
}
```

**버튼 파라미터 설명**:
- `name`: 버튼에 표시될 텍스트 (최대 14자)
- `linkType`: 버튼 타입
  - `WL`: 웹 링크
  - `AL`: 앱 링크
  - `BK`: 봇 키워드
  - `MD`: 메시지 전달
- `linkMo`: 모바일 URL
- `linkPc`: PC URL

---

## 5️⃣ 템플릿 상태 확인

### API로 템플릿 목록 조회

**엔드포인트**:
```
POST https://talks.mtsco.co.kr/kakaoTalk/atk/getTemplateList
```

**요청**:
```bash
curl -X POST "https://talks.mtsco.co.kr/kakaoTalk/atk/getTemplateList" \
  -H "Content-Type: application/json" \
  -d '{
    "auth_code": "7z12bG8oKXrMnHZcJBtycw==",
    "sender_key": "YOUR_SENDER_KEY",
    "page": 1,
    "count": 100
  }'
```

**응답**:
```json
{
  "code": "1000",
  "list": [
    {
      "template_code": "TEST_TEMPLATE_001",
      "template_name": "테스트 알림톡",
      "template_content": "안녕하세요!...",
      "status": "APPROVED",
      "buttons": []
    }
  ]
}
```

**템플릿 상태 (status)**:
- `REQ`: 검수 요청
- `REG`: 등록 완료 (검수 대기)
- `APPROVED`: 승인 완료 ✅ (사용 가능)
- `REJECTED`: 반려됨 ❌
- `STOP`: 중지됨

---

## 6️⃣ 현재 프로젝트에서 템플릿 조회 방법

### 방법 A: 브라우저에서 API 호출

개발 서버가 실행 중이므로 브라우저 콘솔에서 직접 API를 호출할 수 있습니다.

1. 브라우저에서 http://localhost:3000 접속
2. 로그인 완료
3. 개발자 도구 (F12) 열기
4. Console 탭에서 다음 코드 실행:

```javascript
// 1. 발신프로필 조회
fetch('/api/kakao/profiles', {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('accessToken')}`,
    'Content-Type': 'application/json'
  }
})
.then(res => res.json())
.then(data => {
  console.log('발신프로필 목록:', data);
  // sender_key 확인
});

// 2. 템플릿 조회 (sender_key 입력 필요)
fetch('/api/kakao/templates?senderKey=YOUR_SENDER_KEY', {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('accessToken')}`,
    'Content-Type': 'application/json'
  }
})
.then(res => res.json())
.then(data => {
  console.log('템플릿 목록:', data);
});
```

### 방법 B: Postman 사용

1. **발신프로필 조회**:
   ```
   GET http://localhost:3000/api/kakao/profiles
   Headers:
     Authorization: Bearer YOUR_ACCESS_TOKEN
   ```

2. **템플릿 조회**:
   ```
   GET http://localhost:3000/api/kakao/templates?senderKey=YOUR_SENDER_KEY
   Headers:
     Authorization: Bearer YOUR_ACCESS_TOKEN
   ```

---

## 7️⃣ 템플릿 등록 후 테스트

템플릿이 **APPROVED** 상태가 되면 즉시 테스트 가능합니다!

### 테스트 시나리오
1. 메시지 발송 페이지 접속: http://localhost:3000/messages/send
2. "카카오/네이버 톡톡" 탭 선택
3. "알림톡" 서브 탭 선택
4. 발신 프로필 선택 → 템플릿 자동 로딩
5. 승인된 템플릿 선택
6. 수신번호 입력
7. 발송!

---

## 8️⃣ 문제 해결 (Troubleshooting)

### Q1. 발신프로필이 조회되지 않아요
**A**: MTS 담당자에게 카카오 발신프로필 연동을 요청하세요.
- 카카오톡 채널이 먼저 개설되어 있어야 합니다.
- MTS 시스템에 발신프로필이 등록되어야 합니다.

### Q2. 템플릿이 반려(REJECTED)되었어요
**A**: 카카오 검수 가이드를 확인하세요.
- 광고성 내용 금지
- 개인정보 요청 금지
- 불필요한 특수문자 사용 금지
- 상세 반려 사유는 카카오 비즈니스 관리자에서 확인 가능

### Q3. 변수가 제대로 치환되지 않아요
**A**: 변수 형식을 확인하세요.
- 올바른 형식: `#{변수명}`
- 변수명은 한글, 영문, 숫자, _ 사용 가능
- 발송 시 반드시 모든 변수에 값을 입력해야 함

### Q4. 버튼이 표시되지 않아요
**A**: 버튼 파라미터를 확인하세요.
- `buttons` 파라미터는 JSON 문자열 형식
- `linkType`에 따라 필수 필드가 다름
- 최대 5개까지 등록 가능

---

## 9️⃣ 추천 템플릿 (바로 사용 가능)

### 템플릿 1: 간단 알림
```json
{
  "templateCode": "SIMPLE_NOTIFICATION",
  "templateName": "간단 알림",
  "templateMessageType": "BA",
  "templateEmphasizeType": "NONE",
  "templateContent": "안녕하세요!\n\n알림 메시지입니다.\n\n감사합니다."
}
```

### 템플릿 2: 회원가입 환영
```json
{
  "templateCode": "WELCOME_MESSAGE",
  "templateName": "회원가입 환영",
  "templateMessageType": "BA",
  "templateEmphasizeType": "NONE",
  "templateContent": "#{고객명}님 환영합니다!\n\n회원가입이 완료되었습니다.\n\n저희 서비스를 이용해주셔서 감사합니다."
}
```

### 템플릿 3: 주문 확인 (버튼 포함)
```json
{
  "templateCode": "ORDER_CONFIRMATION",
  "templateName": "주문 확인",
  "templateMessageType": "BA",
  "templateEmphasizeType": "NONE",
  "templateContent": "#{고객명}님의 주문이 완료되었습니다.\n\n주문번호: #{주문번호}\n상품명: #{상품명}\n금액: #{금액}원\n\n감사합니다.",
  "buttons": "[{\"name\":\"주문 상세보기\",\"linkType\":\"WL\",\"linkMo\":\"https://example.com/order\",\"linkPc\":\"https://example.com/order\"}]"
}
```

---

## 🎯 다음 단계

템플릿 등록이 완료되고 승인되면:

1. **템플릿 상태 확인**: `status` = `APPROVED` 확인
2. **실제 발송 테스트**: 메시지 발송 페이지에서 테스트
3. **Phase 3 완료**: 카카오 알림톡 테스트 완료!
4. **Phase 4 진행**: 카카오 친구톡 V2 테스트

---

## 📞 문의

- **MTS API 관련**: MTS 담당자 연락
- **카카오 템플릿 검수**: 카카오 비즈니스 고객센터 (1544-4293)
- **프로젝트 코드**: GitHub Issue 등록

---

**문서 종료**
**작성자**: Claude Code
**최종 수정일**: 2025-10-29
