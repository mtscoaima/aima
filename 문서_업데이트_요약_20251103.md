# 문서 업데이트 요약 (2025-11-03)

## 업데이트 목적

메시지 요금 변경사항을 모든 문서에 반영하고, 중복되거나 불필요한 내용 제거

## 요금 변경 내역

### 이전 → 변경 후

| 메시지 타입 | 이전 요금 | 변경 후 | 비고 |
|------------|---------|---------|------|
| SMS | 20원 | **25원** | +5원 |
| LMS | 50원 | **50원** | 변경 없음 |
| MMS | 200원 | **100원** | -100원 |
| 카카오 알림톡 | 15원 | **13원** | -2원 |
| 카카오 친구톡 | 30원 | **20원** | -10원 |
| 카카오 브랜드 | 15원 | **20원** | +5원 |
| 네이버 스마트알림 | 15원 | **13원** | -2원 |
| 네이버 톡톡광고 | - | **20원** | 신규 |

## 수정된 코드 파일 (7개)

### 1. 공통 라이브러리 (1개)

#### `/lib/messageSender.ts`
- Line 393: `SMS: 20 → 25`
- Line 397: `MMS: 200 → 100`
- Line 399: `default: 20 → 25`
- **중요**: 이 함수는 `/api/messages/send` 엔드포인트에서 SMS/LMS/MMS 발송 시 사용됨

### 2. API 엔드포인트 (5개)

#### `/api/messages/kakao/alimtalk/send/route.ts`
- Line 146: `credit_used: 15 → 13`
- Line 178: `unitPrice = 15 → 13`

#### `/api/messages/kakao/friendtalk/send/route.ts`
- Line 161: `credit_used: 30 → 20`
- Line 194: `unitPrice = 30 → 20`

#### `/api/messages/kakao/brand/send/route.ts`
- Line 124: `costPerMessage = 15 → 20`

#### `/api/messages/naver/talk/send/route.ts`
- Line 95-98: 조건부 가격 로직 추가
  ```typescript
  const NAVER_TALK_COST = productCode === 'BENEFIT' ? 20 : 13;
  ```
- Line 153: `credit_used: NAVER_TALK_COST`

#### `/api/messages/scheduled-send-check/route.ts`
- Line 30-38: MESSAGE_COSTS 객체 전체 업데이트
  ```typescript
  const MESSAGE_COSTS: Record<string, number> = {
    SMS: 25,
    LMS: 50,
    MMS: 100,
    KAKAO_ALIMTALK: 13,
    KAKAO_FRIENDTALK: 20,
    NAVER_TALK: 13,
    KAKAO_BRAND: 20,
  };
  ```

## 수정된 문서 파일 (5개)

### 1. `MTS_API_통합_테스트_가이드.md`

**변경 전**: ~2000 lines (중복 섹션 다수)
**변경 후**: 413 lines

**주요 변경사항**:
- 완전 재작성 (중복 제거)
- 요금표 업데이트 (섹션 1)
- Phase 3-6 체크박스 전체 리셋 ([ ])
- 불필요한 히스토리 제거
- 테스트 시나리오 간소화

### 2. `MTS_API_전환_통합_가이드.md`

**변경 전**: ~2000 lines (33485 tokens)
**변경 후**: 569 lines

**주요 변경사항**:
- 완전 재작성 (중복 제거)
- 요금표 섹션 신규 추가
- Phase별 구현 내용 정리
- MESSAGE_COSTS 예제 코드 추가
- 조건부 가격 로직 설명 추가 (네이버톡)

### 3. `MTS_API_사용_현황_템플릿.txt`

**변경사항**:
- 요금 정보 업데이트
- Brand 템플릿 fetch API 완료 표시
- Rich UI 8 sections 설명 추가

### 4. `MTS_API_코드_위치_안내.txt`

**변경사항**:
- 요금 정보 업데이트
- 파일 경로 최신화

### 5. `MTS_MESSAGE_코드베이스_분석_v4.1.md`

**변경사항**:
- Line 1951: 비용 요약 업데이트
- Line 2018-2022: 기능별 비용 테이블 업데이트
- Line 2133-2137: 상세 비용 테이블 업데이트 (비고란 추가)

## 검증 완료 사항

### 코드 검증
✅ `messageSender.ts` getMessageCredit() 함수 확인 (SMS 25원, MMS 100원)
✅ 모든 API 엔드포인트 `credit_used` 값 확인
✅ 모든 `transactions` 테이블 `amount` 값 확인
✅ `MESSAGE_COSTS` 객체 정확성 확인
✅ 조건부 가격 로직 (네이버톡 BENEFIT) 확인
✅ TypeScript 빌드 성공 (에러 0개)

### 문서 검증
✅ 모든 문서에서 구 요금 제거 확인
✅ 중복 섹션 제거 확인
✅ 요금표 일관성 확인

## 최종 상태

- **수정된 코드 파일**: 7개 (공통 라이브러리 1개 + API 엔드포인트 5개 + Cron 1개)
- **수정된 문서 파일**: 5개
- **총 변경 라인 수**: 코드 ~60 lines, 문서 ~3500 lines 감소
- **문서 크기 감소**: 약 70% 감소 (중복 제거)

## 테스트 계획

다음 단계: Phase 3-6 순차 테스트 진행
- [ ] Phase 3: 카카오 알림톡 테스트 (13원 확인)
- [ ] Phase 4: 카카오 친구톡 테스트 (20원 확인)
- [ ] Phase 5: 네이버 톡톡 테스트 (13원/20원 확인)
- [ ] Phase 6: 카카오 브랜드 테스트 (20원 확인)

---

**작성일**: 2025-11-03
**작성자**: Claude Code
**문서 버전**: 1.0
