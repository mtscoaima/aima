================================================================================
ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€ ë°œì†¡ ê¸°ëŠ¥ êµ¬í˜„ ê³„íšì„œ (ìƒì„¸)
================================================================================
ì‘ì„±ì¼: 2025-10-15
ëŒ€ìƒ: ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡/ì¹œêµ¬í†¡/ë¸Œëœë“œ ë©”ì‹œì§€
êµ¬í˜„ ë°©ì‹: ì§ì ‘ ì—°ë™ (ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ API)


================================================================================
ëª©ì°¨
================================================================================
1. ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì • ì¤€ë¹„
2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
3. API ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„
4. ë‹¨ê³„ë³„ êµ¬í˜„ ê³„íš
5. ì•Œë¦¼í†¡ êµ¬í˜„ ìƒì„¸
6. ì¹œêµ¬í†¡ êµ¬í˜„ ìƒì„¸
7. ë¸Œëœë“œ ë©”ì‹œì§€ êµ¬í˜„ ìƒì„¸
8. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
9. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…


================================================================================
1. ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì • ì¤€ë¹„
================================================================================

1.1 í•„ìˆ˜ ì¤€ë¹„ ì‚¬í•­
-----------------
âš ï¸ êµ¬í˜„ ì‹œì‘ ì „ ë°˜ë“œì‹œ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤!

[ ] ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì… (https://business.kakao.com/)
    â””â”€ ì‚¬ì—…ì ë“±ë¡ì¦ í•„ìš”
    â””â”€ ëŒ€í‘œì ë³¸ì¸ ì¸ì¦

[ ] ì¹´ì¹´ì˜¤í†¡ ì±„ë„ ê°œì„¤
    â””â”€ ë¹„ì¦ˆë‹ˆìŠ¤ > ì¹´ì¹´ì˜¤í†¡ ì±„ë„ > ìƒˆ ì±„ë„ ë§Œë“¤ê¸°
    â””â”€ ì±„ë„ëª…, í”„ë¡œí•„ ì´ë¯¸ì§€ ì„¤ì •
    â””â”€ ê²€ìƒ‰ìš© ID ì„¤ì •

[ ] ë°œì‹  í”„ë¡œí•„ ë“±ë¡ ë° ì‹¬ì‚¬ (1-3ì¼ ì†Œìš”)
    â””â”€ ê´€ë¦¬ > ë°œì‹  í”„ë¡œí•„ > í”„ë¡œí•„ ë§Œë“¤ê¸°
    â””â”€ ì¹´ì¹´ì˜¤ ì‹¬ì‚¬íŒ€ ìŠ¹ì¸ ëŒ€ê¸°

[ ] ì•Œë¦¼í†¡ í…œí”Œë¦¿ ìµœì†Œ 1ê°œ ë“±ë¡ ë° ìŠ¹ì¸ (2-3ì¼ ì†Œìš”)
    â””â”€ ë©”ì‹œì§€ > ì•Œë¦¼í†¡ > í…œí”Œë¦¿ ë“±ë¡
    â””â”€ í…œí”Œë¦¿ ì½”ë“œ ë°œê¸‰ ë°›ê¸°


1.2 í•„ìš”í•œ ì •ë³´ ìˆ˜ì§‘
------------------
êµ¬í˜„ì— í•„ìš”í•œ ê°’ë“¤ì„ ë¯¸ë¦¬ ì¤€ë¹„í•˜ì„¸ìš”:

âœ… Sender Key (ë°œì‹  í”„ë¡œí•„ í‚¤)
   ìœ„ì¹˜: ê´€ë¦¬ > ë°œì‹  í”„ë¡œí•„ > í”„ë¡œí•„ ìƒì„¸
   ì˜ˆì‹œ: abc1234567890def

âœ… Channel ID
   ìœ„ì¹˜: ê´€ë¦¬ > ë‚´ ì±„ë„ > ì±„ë„ í™ˆ URLì˜ ë§ˆì§€ë§‰ ë¶€ë¶„
   ì˜ˆì‹œ: _abc1234

âœ… REST API Key
   ìœ„ì¹˜: Kakao Developers > ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ > ì•± í‚¤
   ì˜ˆì‹œ: 1234567890abcdef1234567890abcdef

âœ… ìŠ¹ì¸ëœ í…œí”Œë¦¿ ì½”ë“œ
   ìœ„ì¹˜: ë©”ì‹œì§€ > ì•Œë¦¼í†¡ > í…œí”Œë¦¿ ê´€ë¦¬
   ì˜ˆì‹œ: template_001


1.3 í™˜ê²½ë³€ìˆ˜ ì„¤ì •
----------------
.env.localì— ì¶”ê°€:

```env
# ===== ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì‹œì§€ =====
KAKAO_BIZM_API_KEY=your_rest_api_key
KAKAO_BIZM_SENDER_KEY=abc1234567890def
KAKAO_BIZM_API_URL=https://kapi.kakao.com/v2/api/talk/memo/default/send
KAKAO_CHANNEL_ID=_abc1234
KAKAO_CHANNEL_UUID=your_channel_uuid
```


================================================================================
2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
================================================================================

2.1 kakao_channels (ì¹´ì¹´ì˜¤ ì±„ë„ ì •ë³´)
------------------------------------
```sql
CREATE TABLE kakao_channels (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  channel_id VARCHAR(100) NOT NULL UNIQUE,       -- ì¹´ì¹´ì˜¤ ì±„ë„ ID (_abc1234)
  channel_name VARCHAR(200) NOT NULL,             -- ì±„ë„ëª…
  sender_key VARCHAR(100),                        -- ë°œì‹  í”„ë¡œí•„ í‚¤
  category VARCHAR(50),                           -- ì¹´í…Œê³ ë¦¬
  profile_image_url TEXT,                         -- í”„ë¡œí•„ ì´ë¯¸ì§€
  status VARCHAR(20) DEFAULT 'pending',           -- 'pending', 'approved', 'rejected'
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_kakao_channels_user_id ON kakao_channels(user_id);
CREATE INDEX idx_kakao_channels_status ON kakao_channels(status);
```


2.2 kakao_channel_groups (ì¹´ì¹´ì˜¤ ì±„ë„ ê·¸ë£¹)
------------------------------------------
```sql
CREATE TABLE kakao_channel_groups (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  group_name VARCHAR(200) NOT NULL,
  description TEXT,
  channel_ids INTEGER[] DEFAULT '{}',             -- ê·¸ë£¹ì— ì†í•œ ì±„ë„ ID ë°°ì—´
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_kakao_groups_user_id ON kakao_channel_groups(user_id);
```


2.3 kakao_templates (ì¹´ì¹´ì˜¤ í…œí”Œë¦¿)
----------------------------------
```sql
CREATE TABLE kakao_templates (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  channel_id INTEGER REFERENCES kakao_channels(id),
  template_type VARCHAR(20) NOT NULL,             -- 'alimtalk', 'friendtalk', 'brand'
  template_code VARCHAR(100),                     -- ì•Œë¦¼í†¡ í…œí”Œë¦¿ ì½”ë“œ
  template_name VARCHAR(200) NOT NULL,
  template_content TEXT NOT NULL,
  template_variables JSONB DEFAULT '[]',          -- [{name: "ê³ ê°ëª…", type: "string"}]
  buttons JSONB DEFAULT '[]',                     -- ë²„íŠ¼ ì •ë³´
  image_url TEXT,                                 -- ì¹œêµ¬í†¡/ë¸Œëœë“œ ì´ë¯¸ì§€
  image_link_url VARCHAR(100),                    -- ì¹œêµ¬í†¡ ì´ë¯¸ì§€ ë§í¬ URL
  brand_template_type VARCHAR(50),                -- 'text', 'image', 'wide', etc.
  status VARCHAR(20) DEFAULT 'pending',           -- 'pending', 'approved', 'rejected'
  rejection_reason TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_kakao_templates_user_id ON kakao_templates(user_id);
CREATE INDEX idx_kakao_templates_type ON kakao_templates(template_type);
CREATE INDEX idx_kakao_templates_status ON kakao_templates(status);
```


2.4 kakao_message_logs (ì¹´ì¹´ì˜¤ ë°œì†¡ ë¡œê·¸)
----------------------------------------
```sql
CREATE TABLE kakao_message_logs (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  message_type VARCHAR(20) NOT NULL,              -- 'alimtalk', 'friendtalk', 'brand'
  template_id INTEGER REFERENCES kakao_templates(id),
  channel_id INTEGER REFERENCES kakao_channels(id),
  to_number VARCHAR(20) NOT NULL,
  to_name VARCHAR(100),
  message_content TEXT NOT NULL,
  subject VARCHAR(100),
  template_variables JSONB,                       -- ì‹¤ì œ ì¹˜í™˜ëœ ë³€ìˆ˜ê°’
  sent_at TIMESTAMP,
  status VARCHAR(20) NOT NULL,                    -- 'sent', 'failed', 'pending'
  error_message TEXT,
  credit_used INTEGER,
  fallback_to_sms BOOLEAN DEFAULT false,
  metadata JSONB,                                 -- ë²„íŠ¼, ì´ë¯¸ì§€ ë“±
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_kakao_logs_user_id ON kakao_message_logs(user_id);
CREATE INDEX idx_kakao_logs_type ON kakao_message_logs(message_type);
CREATE INDEX idx_kakao_logs_sent_at ON kakao_message_logs(sent_at);
CREATE INDEX idx_kakao_logs_status ON kakao_message_logs(status);
```


================================================================================
3. API ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„
================================================================================

3.1 ì±„ë„ ê´€ë¦¬ API
----------------

ğŸ“ POST /api/kakao/channels
ì„¤ëª…: ì¹´ì¹´ì˜¤ ì±„ë„ ë“±ë¡
ìš”ì²­:
```json
{
  "channelId": "_abc1234",
  "channelName": "ìš°ë¦¬ íšŒì‚¬ ì±„ë„",
  "senderKey": "abc1234567890def",
  "category": "ì„œë¹„ìŠ¤"
}
```
ì‘ë‹µ:
```json
{
  "success": true,
  "channel": {
    "id": 1,
    "channelId": "_abc1234",
    "channelName": "ìš°ë¦¬ íšŒì‚¬ ì±„ë„",
    "status": "approved"
  }
}
```

ğŸ“ GET /api/kakao/channels
ì„¤ëª…: ì¹´ì¹´ì˜¤ ì±„ë„ ëª©ë¡ ì¡°íšŒ
ì¿¼ë¦¬: ?search=ê²€ìƒ‰ì–´
ì‘ë‹µ:
```json
{
  "channels": [
    {
      "id": 1,
      "channelId": "_abc1234",
      "channelName": "ìš°ë¦¬ íšŒì‚¬ ì±„ë„",
      "senderKey": "abc1234567890def",
      "status": "approved"
    }
  ],
  "total": 1
}
```

ğŸ“ DELETE /api/kakao/channels/:id
ì„¤ëª…: ì¹´ì¹´ì˜¤ ì±„ë„ ì‚­ì œ


3.2 ì±„ë„ ê·¸ë£¹ ê´€ë¦¬ API
---------------------

ğŸ“ POST /api/kakao/channel-groups
ì„¤ëª…: ì±„ë„ ê·¸ë£¹ ìƒì„±
ìš”ì²­:
```json
{
  "groupName": "ë§ˆì¼€íŒ…íŒ€",
  "description": "ë§ˆì¼€íŒ… ì „ìš© ì±„ë„",
  "channelIds": [1, 2, 3]
}
```

ğŸ“ GET /api/kakao/channel-groups
ì„¤ëª…: ê·¸ë£¹ ëª©ë¡ ì¡°íšŒ

ğŸ“ DELETE /api/kakao/channel-groups/:id
ì„¤ëª…: ê·¸ë£¹ ì‚­ì œ


3.3 í…œí”Œë¦¿ ê´€ë¦¬ API
------------------

ğŸ“ POST /api/kakao/templates
ì„¤ëª…: ì¹´ì¹´ì˜¤ í…œí”Œë¦¿ ë“±ë¡
ìš”ì²­:
```json
{
  "channelId": 1,
  "templateType": "alimtalk",
  "templateCode": "template_001",
  "templateName": "ë°°ì†¡ ì•Œë¦¼",
  "templateContent": "#{ê³ ê°ëª…}ë‹˜, ì£¼ë¬¸í•˜ì‹  ìƒí’ˆì´ #{ì‹œê°„}ì— ë°°ì†¡ë©ë‹ˆë‹¤.",
  "templateVariables": [
    {"name": "ê³ ê°ëª…", "type": "string"},
    {"name": "ì‹œê°„", "type": "string"}
  ],
  "buttons": [
    {"name": "ë°°ì†¡ì¡°íšŒ", "type": "WL", "url": "https://example.com/track"}
  ]
}
```

ğŸ“ GET /api/kakao/templates
ì„¤ëª…: í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ
ì¿¼ë¦¬: ?type=alimtalk&search=ê²€ìƒ‰ì–´&status=approved

ğŸ“ GET /api/kakao/templates/:id
ì„¤ëª…: í…œí”Œë¦¿ ìƒì„¸ ì¡°íšŒ

ğŸ“ DELETE /api/kakao/templates/:id
ì„¤ëª…: í…œí”Œë¦¿ ì‚­ì œ


3.4 ë©”ì‹œì§€ ë°œì†¡ API
------------------

ğŸ“ POST /api/kakao/send/alimtalk
ì„¤ëª…: ì•Œë¦¼í†¡ ë°œì†¡
ìš”ì²­:
```json
{
  "templateCode": "template_001",
  "recipients": [
    {
      "phone_number": "01012345678",
      "name": "í™ê¸¸ë™",
      "variables": {
        "ê³ ê°ëª…": "í™ê¸¸ë™",
        "ì‹œê°„": "14:00"
      }
    }
  ],
  "fallbackToSms": true
}
```
ì‘ë‹µ:
```json
{
  "success": true,
  "results": [
    {
      "recipient": "01012345678",
      "success": true,
      "messageId": "msg_123456"
    }
  ]
}
```

ğŸ“ POST /api/kakao/send/friendtalk
ì„¤ëª…: ì¹œêµ¬í†¡ ë°œì†¡
ìš”ì²­:
```json
{
  "channelId": 1,
  "recipients": [
    {
      "phone_number": "01012345678",
      "name": "í™ê¸¸ë™"
    }
  ],
  "message": "ì•ˆë…•í•˜ì„¸ìš”! ì‹ ì œí’ˆ ì¶œì‹œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.",
  "imageUrl": "https://example.com/image.jpg",
  "imageLinkUrl": "https://example.com/product",
  "buttons": [
    {"name": "ìì„¸íˆë³´ê¸°", "type": "WL", "url": "https://example.com"}
  ],
  "isAd": true
}
```

ğŸ“ POST /api/kakao/send/brand
ì„¤ëª…: ë¸Œëœë“œ ë©”ì‹œì§€ ë°œì†¡

ğŸ“ POST /api/kakao/upload/image
ì„¤ëª…: ì¹´ì¹´ì˜¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ (Supabase Storage ì‚¬ìš©)


================================================================================
4. ë‹¨ê³„ë³„ êµ¬í˜„ ê³„íš
================================================================================

Week 1: ì±„ë„ ê´€ë¦¬ ë° ê¸°ë³¸ êµ¬ì¡°
-------------------------------
Day 1-2:
[ ] DB ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„± (4ê°œ í…Œì´ë¸”)
[ ] Supabaseì— í…Œì´ë¸” ìƒì„± ë° RLS ì •ì±… ì„¤ì •
[ ] ì¹´ì¹´ì˜¤ API í´ë¼ì´ì–¸íŠ¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‘ì„±
    â””â”€ src/lib/kakao-api.ts

Day 3-4:
[ ] POST /api/kakao/channels êµ¬í˜„
[ ] GET /api/kakao/channels êµ¬í˜„
[ ] DELETE /api/kakao/channels/:id êµ¬í˜„
[ ] KakaoChannelTab UI ì—°ë™
    â””â”€ ì±„ë„ ì—°ë™ ë²„íŠ¼
    â””â”€ ì±„ë„ ëª©ë¡ ë Œë”ë§
    â””â”€ ê²€ìƒ‰ ê¸°ëŠ¥

Day 5:
[ ] POST /api/kakao/channel-groups êµ¬í˜„
[ ] GET /api/kakao/channel-groups êµ¬í˜„
[ ] DELETE /api/kakao/channel-groups/:id êµ¬í˜„
[ ] KakaoChannelTab ê·¸ë£¹ ê´€ë¦¬ UI ì—°ë™


Week 2: ì•Œë¦¼í†¡ êµ¬í˜„
-------------------
Day 1-2:
[ ] POST /api/kakao/templates (ì•Œë¦¼í†¡) êµ¬í˜„
[ ] GET /api/kakao/templates?type=alimtalk êµ¬í˜„
[ ] KakaoAlimtalkTab UI ì—°ë™
    â””â”€ í…œí”Œë¦¿ ë“±ë¡ ëª¨ë‹¬
    â””â”€ í…œí”Œë¦¿ ëª©ë¡
    â””â”€ í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°

Day 3-4:
[ ] POST /api/kakao/send/alimtalk êµ¬í˜„
[ ] KakaoMessageContent (ì•Œë¦¼í†¡ íƒ­) UI ì—°ë™
    â””â”€ ì±„ë„ ë“œë¡­ë‹¤ìš´
    â””â”€ í…œí”Œë¦¿ ë“œë¡­ë‹¤ìš´
    â””â”€ í…œí”Œë¦¿ ë‚´ìš© ìë™ ë¡œë“œ
    â””â”€ ë³€ìˆ˜ ì¹˜í™˜ ë¡œì§

Day 5:
[ ] ëŒ€ì²´ë°œì†¡ ë¡œì§ êµ¬í˜„ (SMS fallback)
[ ] ë°œì†¡ ë¡œê·¸ ì €ì¥
[ ] ì—ëŸ¬ ì²˜ë¦¬
[ ] í…ŒìŠ¤íŠ¸


Week 3: ì¹œêµ¬í†¡ êµ¬í˜„
------------------
Day 1-2:
[ ] POST /api/kakao/upload/image êµ¬í˜„
    â””â”€ Supabase Storage ì—…ë¡œë“œ
    â””â”€ 500KB ì œí•œ, 500x250px ì´ìƒ ê²€ì¦
[ ] KakaoMessageContent (ì¹œêµ¬í†¡ íƒ­) ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—°ë™

Day 3-4:
[ ] POST /api/kakao/send/friendtalk êµ¬í˜„
    â””â”€ ë©”ì‹œì§€ ë‚´ìš© (ìµœëŒ€ 1,000ì)
    â””â”€ ì´ë¯¸ì§€ ì²¨ë¶€
    â””â”€ ì´ë¯¸ì§€ ë§í¬ URL
    â””â”€ ë²„íŠ¼ ì¶”ê°€
[ ] ê´‘ê³ ë©”ì‹œì§€ ìë™ í‘œê¸° ("(ê´‘ê³ )" prefix)

Day 5:
[ ] KakaoMessageContent (ì¹œêµ¬í†¡ íƒ­) UI ì—°ë™
[ ] ë²„íŠ¼ ì¶”ê°€ ëª¨ë‹¬ êµ¬í˜„
[ ] í…ŒìŠ¤íŠ¸


Week 4: ë¸Œëœë“œ ë©”ì‹œì§€ êµ¬í˜„
-------------------------
Day 1-2:
[ ] POST /api/kakao/templates (ë¸Œëœë“œ) êµ¬í˜„
    â””â”€ 8ê°€ì§€ í…œí”Œë¦¿ íƒ€ì… ì²˜ë¦¬
[ ] GET /api/kakao/templates?type=brand êµ¬í˜„
[ ] KakaoBrandTab UI ì—°ë™

Day 3-4:
[ ] POST /api/kakao/send/brand êµ¬í˜„
    â””â”€ ìˆ˜ì‹ ëŒ€ìƒ í•„í„°ë§ (ì±„ë„ì¹œêµ¬ë§Œ)
[ ] KakaoMessageContent (ë¸Œëœë“œ íƒ­) UI ì—°ë™
    â””â”€ í…œí”Œë¦¿ íƒ€ì… ì„ íƒ
    â””â”€ í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ë¡œë“œ

Day 5:
[ ] í†µí•© í…ŒìŠ¤íŠ¸
[ ] ë²„ê·¸ ìˆ˜ì •
[ ] ë¬¸ì„œí™”


================================================================================
5. ì•Œë¦¼í†¡ êµ¬í˜„ ìƒì„¸
================================================================================

5.1 ì•Œë¦¼í†¡ íŠ¹ì§•
--------------
âœ… ì‚¬ì „ ìŠ¹ì¸ëœ í…œí”Œë¦¿ë§Œ ì‚¬ìš© ê°€ëŠ¥
âœ… í…œí”Œë¦¿ ë‚´ìš© ìˆ˜ì • ë¶ˆê°€ (ë³€ìˆ˜ ì¹˜í™˜ë§Œ ê°€ëŠ¥)
âœ… ë°œì†¡ ì„±ê³µë¥  ë†’ìŒ
âœ… ê´‘ê³  ì•„ë‹˜ (ìˆ˜ì‹ ê±°ë¶€ ë¶ˆí•„ìš”)
âœ… ì¹´ì¹´ì˜¤í†¡ ì•± í‘¸ì‹œ ì•Œë¦¼


5.2 í…œí”Œë¦¿ ë“±ë¡ ì ˆì°¨
-------------------
1. ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ > ë©”ì‹œì§€ > ì•Œë¦¼í†¡ > í…œí”Œë¦¿ ë“±ë¡
2. í…œí”Œë¦¿ ë‚´ìš© ì‘ì„±
   - ë³€ìˆ˜: #{ë³€ìˆ˜ëª…} í˜•ì‹
   - ìµœëŒ€ 1,000ì
3. ì¹´í…Œê³ ë¦¬ ì„ íƒ
4. í…œí”Œë¦¿ ì‹¬ì‚¬ ì‹ ì²­
5. ìŠ¹ì¸ ëŒ€ê¸° (2-3ì¼)
6. ìŠ¹ì¸ í›„ í…œí”Œë¦¿ ì½”ë“œ ë°œê¸‰


5.3 ë°œì†¡ API êµ¬í˜„ ì˜ˆì‹œ
---------------------
src/app/api/kakao/send/alimtalk/route.ts

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { createClient } from '@supabase/supabase-js';
import { verifyToken } from '@/lib/auth';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
);

export async function POST(request: NextRequest) {
  try {
    // JWT ì¸ì¦
    const token = request.headers.get('Authorization')?.replace('Bearer ', '');
    const userId = await verifyToken(token);
    if (!userId) {
      return NextResponse.json({ error: 'ì¸ì¦ ì‹¤íŒ¨' }, { status: 401 });
    }

    const body = await request.json();
    const { templateCode, recipients, fallbackToSms } = body;

    // í…œí”Œë¦¿ ì¡°íšŒ
    const { data: template, error: templateError } = await supabase
      .from('kakao_templates')
      .select('*, kakao_channels(sender_key)')
      .eq('template_code', templateCode)
      .eq('template_type', 'alimtalk')
      .eq('status', 'approved')
      .single();

    if (templateError || !template) {
      return NextResponse.json({ error: 'ìŠ¹ì¸ë˜ì§€ ì•Šì€ í…œí”Œë¦¿' }, { status: 400 });
    }

    // ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ API í˜¸ì¶œ
    const results = [];
    for (const recipient of recipients) {
      try {
        const response = await fetch('https://kapi.kakao.com/v2/api/talk/memo/default/send', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `KakaoAK ${process.env.KAKAO_BIZM_API_KEY!}`
          },
          body: JSON.stringify({
            template_object: {
              object_type: 'text',
              text: template.template_content,
              button_title: 'í™•ì¸'
            }
          })
        });

        const data = await response.json();
        const success = response.ok && data.result_code === 0;

        results.push({
          recipient: recipient.phone_number,
          success: success,
          messageId: success ? data.message_id : null
        });

        // ë¡œê·¸ ì €ì¥
        await supabase.from('kakao_message_logs').insert({
          user_id: userId,
          message_type: 'alimtalk',
          template_id: template.id,
          channel_id: template.channel_id,
          to_number: recipient.phone_number,
          to_name: recipient.name,
          message_content: template.template_content,
          template_variables: recipient.variables,
          status: success ? 'sent' : 'failed',
          error_message: success ? null : data.msg,
          credit_used: 15 // ì•Œë¦¼í†¡ ë‹¨ê°€
        });

        // ëŒ€ì²´ë°œì†¡ (ì‹¤íŒ¨ ì‹œ)
        if (!success && fallbackToSms) {
          // SMS ë°œì†¡ API í˜¸ì¶œ
          await sendFallbackSms(recipient, template.template_content);
        }

      } catch (error) {
        results.push({
          recipient: recipient.phone_number,
          success: false
        });
      }
    }

    return NextResponse.json({ success: true, results });
  } catch (error) {
    console.error('ì•Œë¦¼í†¡ ë°œì†¡ ì˜¤ë¥˜:', error);
    return NextResponse.json({ error: 'ë°œì†¡ ì‹¤íŒ¨' }, { status: 500 });
  }
}

async function sendFallbackSms(recipient: any, content: string) {
  // SMS ë°œì†¡ ë¡œì§ (ê¸°ì¡´ Naver SENS API ì‚¬ìš©)
  // TODO: êµ¬í˜„
}
```


5.4 ë³€ìˆ˜ ì¹˜í™˜ ë¡œì§
-----------------
í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ (KakaoMessageContent.tsx):

```typescript
function replaceVariables(template: string, variables: Record<string, string>) {
  let result = template;
  Object.entries(variables).forEach(([key, value]) => {
    const regex = new RegExp(`#{${key}}`, 'g');
    result = result.replace(regex, value);
  });
  return result;
}

// ì‚¬ìš© ì˜ˆì‹œ
const templateContent = "#{ê³ ê°ëª…}ë‹˜, ì£¼ë¬¸í•˜ì‹  ìƒí’ˆì´ #{ì‹œê°„}ì— ë°°ì†¡ë©ë‹ˆë‹¤.";
const variables = { "ê³ ê°ëª…": "í™ê¸¸ë™", "ì‹œê°„": "14:00" };
const finalMessage = replaceVariables(templateContent, variables);
// ê²°ê³¼: "í™ê¸¸ë™ë‹˜, ì£¼ë¬¸í•˜ì‹  ìƒí’ˆì´ 14:00ì— ë°°ì†¡ë©ë‹ˆë‹¤."
```


================================================================================
6. ì¹œêµ¬í†¡ êµ¬í˜„ ìƒì„¸
================================================================================

6.1 ì¹œêµ¬í†¡ íŠ¹ì§•
--------------
âœ… ë‚´ìš© ììœ  ì‘ì„± (í…œí”Œë¦¿ ì‚¬ì „ ìŠ¹ì¸ ë¶ˆí•„ìš”)
âœ… ì¹œêµ¬ ì¶”ê°€í•œ ì‚¬ìš©ìì—ê²Œë§Œ ë°œì†¡ ê°€ëŠ¥
âœ… ì´ë¯¸ì§€ ì²¨ë¶€ ê°€ëŠ¥ (500KB ì´í•˜, 500x250px ì´ìƒ)
âœ… ë²„íŠ¼ ì¶”ê°€ ê°€ëŠ¥
âœ… ê´‘ê³ ì„± ë©”ì‹œì§€ ê°€ëŠ¥ (ìë™ "(ê´‘ê³ )" í‘œê¸°)


6.2 ì´ë¯¸ì§€ ì—…ë¡œë“œ êµ¬í˜„
--------------------
src/app/api/kakao/upload/image/route.ts

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
);

export async function POST(request: NextRequest) {
  try {
    const formData = await request.formData();
    const file = formData.get('file') as File;

    if (!file) {
      return NextResponse.json({ error: 'íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤' }, { status: 400 });
    }

    // íŒŒì¼ í¬ê¸° ê²€ì¦ (500KB)
    if (file.size > 500 * 1024) {
      return NextResponse.json({ error: 'ì´ë¯¸ì§€ëŠ” 500KB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤' }, { status: 400 });
    }

    // íŒŒì¼ í˜•ì‹ ê²€ì¦
    if (!['image/jpeg', 'image/jpg', 'image/png'].includes(file.type)) {
      return NextResponse.json({ error: 'JPG, PNG í˜•ì‹ë§Œ ì§€ì›í•©ë‹ˆë‹¤' }, { status: 400 });
    }

    // Supabase Storage ì—…ë¡œë“œ
    const fileName = `kakao/${Date.now()}_${file.name}`;
    const { data, error } = await supabase.storage
      .from('message-images')
      .upload(fileName, file);

    if (error) {
      throw error;
    }

    // Public URL ìƒì„±
    const { data: { publicUrl } } = supabase.storage
      .from('message-images')
      .getPublicUrl(fileName);

    return NextResponse.json({
      success: true,
      imageUrl: publicUrl,
      fileName: file.name,
      fileSize: file.size
    });

  } catch (error) {
    console.error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
    return NextResponse.json({ error: 'ì—…ë¡œë“œ ì‹¤íŒ¨' }, { status: 500 });
  }
}
```


6.3 ê´‘ê³ ë©”ì‹œì§€ ìë™ í‘œê¸°
-----------------------
```typescript
function formatAdMessage(message: string, isAd: boolean): string {
  if (!isAd) return message;

  // ì´ë¯¸ "(ê´‘ê³ )"ê°€ ìˆìœ¼ë©´ ì¤‘ë³µ ì¶”ê°€ ë°©ì§€
  if (message.startsWith('(ê´‘ê³ )')) return message;

  return `(ê´‘ê³ ) ${message}`;
}
```


6.4 ë²„íŠ¼ JSON êµ¬ì¡°
-----------------
```json
{
  "buttons": [
    {
      "name": "ìì„¸íˆë³´ê¸°",
      "type": "WL",
      "url": "https://example.com/product"
    },
    {
      "name": "ì „í™”í•˜ê¸°",
      "type": "AC",
      "url": "tel:0212345678"
    }
  ]
}
```

ë²„íŠ¼ íƒ€ì…:
- WL: ì›¹ ë§í¬
- AL: ì•± ë§í¬
- AC: ì „í™”ê±¸ê¸°


================================================================================
7. ë¸Œëœë“œ ë©”ì‹œì§€ êµ¬í˜„ ìƒì„¸
================================================================================

7.1 ë¸Œëœë“œ ë©”ì‹œì§€ íŠ¹ì§•
--------------------
âœ… 8ê°€ì§€ í…œí”Œë¦¿ íƒ€ì… ì§€ì›
âœ… ë¦¬ì¹˜ ë¯¸ë””ì–´ (ì´ë¯¸ì§€, ë¹„ë””ì˜¤)
âœ… ìˆ˜ì‹ ëŒ€ìƒ í•„í„°ë§ (ì±„ë„ì¹œêµ¬ë§Œ)
âœ… í…œí”Œë¦¿ ì‚¬ì „ ë“±ë¡ í•„ìš”


7.2 8ê°€ì§€ í…œí”Œë¦¿ íƒ€ì…
--------------------
1. í…ìŠ¤íŠ¸í˜• (text)
2. ì´ë¯¸ì§€í˜• (image)
3. ì™€ì´ë“œí˜• (wide)
4. ì™€ì´ë“œë¦¬ìŠ¤íŠ¸í˜• (widelist)
5. ìºëŸ¬ì…€í”¼ë“œí˜• (carousel_feed)
6. ì»¤ë¨¸ìŠ¤í˜• (commerce)
7. ìºëŸ¬ì…€ì»¤ë¨¸ìŠ¤í˜• (carousel_commerce)
8. í”„ë¦¬ë¯¸ì—„ë™ì˜ìƒ (premium_video) - ë¹„í™œì„±


7.3 ìˆ˜ì‹ ëŒ€ìƒ í•„í„°ë§
------------------
- ì „ì²´: ëª¨ë“  ìˆ˜ì‹ ì (ë¹„í™œì„±)
- ìˆ˜ì‹ ë™ì˜ìë§Œ: ë§ˆì¼€íŒ… ìˆ˜ì‹  ë™ì˜í•œ ì‚¬ìš©ì (ë¹„í™œì„±)
- ì±„ë„ì¹œêµ¬ë§Œ: ì¹´ì¹´ì˜¤í†¡ ì±„ë„ ì¹œêµ¬ ì¶”ê°€í•œ ì‚¬ìš©ì (í™œì„±)


================================================================================
8. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
================================================================================

8.1 ì±„ë„ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
-------------------
[ ] ì±„ë„ ì—°ë™ ë²„íŠ¼ í´ë¦­
[ ] ì±„ë„ ì •ë³´ ì…ë ¥ (Channel ID, Sender Key)
[ ] ì±„ë„ ë“±ë¡ ì„±ê³µ í™•ì¸
[ ] ì±„ë„ ëª©ë¡ì— í‘œì‹œ í™•ì¸
[ ] ì±„ë„ ê²€ìƒ‰ ê¸°ëŠ¥ í™•ì¸
[ ] ê·¸ë£¹ ìƒì„± í…ŒìŠ¤íŠ¸
[ ] ê·¸ë£¹ì— ì±„ë„ ì¶”ê°€
[ ] ì±„ë„ ì‚­ì œ í…ŒìŠ¤íŠ¸


8.2 ì•Œë¦¼í†¡ í…ŒìŠ¤íŠ¸
----------------
[ ] í…œí”Œë¦¿ ë“±ë¡ (ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ì—ì„œ)
[ ] í…œí”Œë¦¿ DB ì €ì¥
[ ] í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ
[ ] í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° í™•ì¸
[ ] ë°œì†¡ í˜ì´ì§€ì—ì„œ ì±„ë„ ì„ íƒ
[ ] í…œí”Œë¦¿ ì„ íƒ
[ ] ë³€ìˆ˜ ë§¤ì¹­ í™•ì¸
[ ] ìˆ˜ì‹ ë²ˆí˜¸ ì¶”ê°€
[ ] ë°œì†¡ í…ŒìŠ¤íŠ¸
[ ] ë°œì†¡ ë¡œê·¸ í™•ì¸
[ ] ëŒ€ì²´ë°œì†¡ í…ŒìŠ¤íŠ¸ (ì˜ë„ì  ì‹¤íŒ¨)


8.3 ì¹œêµ¬í†¡ í…ŒìŠ¤íŠ¸
----------------
[ ] ì±„ë„ ì„ íƒ
[ ] ë©”ì‹œì§€ ì‘ì„± (1,000ì ì´í•˜)
[ ] ì¹˜í™˜ë¬¸êµ¬ ì¶”ê°€ í…ŒìŠ¤íŠ¸
[ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ (500KB ì´í•˜)
[ ] ì´ë¯¸ì§€ ë§í¬ URL ì…ë ¥
[ ] ë²„íŠ¼ ì¶”ê°€ (ì›¹ ë§í¬)
[ ] ê´‘ê³ ë©”ì‹œì§€ ì²´í¬ ì‹œ "(ê´‘ê³ )" ìë™ ì¶”ê°€ í™•ì¸
[ ] ë°œì†¡ í…ŒìŠ¤íŠ¸
[ ] ë°œì†¡ ë¡œê·¸ í™•ì¸


8.4 ë¸Œëœë“œ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸
-----------------------
[ ] ë¸Œëœë“œ í…œí”Œë¦¿ ë“±ë¡
[ ] í…œí”Œë¦¿ íƒ€ì… ì„ íƒ (ì™€ì´ë“œí˜•)
[ ] í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ í™•ì¸
[ ] ìˆ˜ì‹ ëŒ€ìƒ "ì±„ë„ì¹œêµ¬ë§Œ" ì„ íƒ
[ ] ë°œì†¡ í…ŒìŠ¤íŠ¸
[ ] ë°œì†¡ ë¡œê·¸ í™•ì¸


================================================================================
9. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
================================================================================

9.1 ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜
--------------------

âŒ "ìŠ¹ì¸ë˜ì§€ ì•Šì€ í…œí”Œë¦¿"
ì›ì¸: í…œí”Œë¦¿ ì‹¬ì‚¬ê°€ ì™„ë£Œë˜ì§€ ì•ŠìŒ
í•´ê²°: ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ì—ì„œ í…œí”Œë¦¿ ìƒíƒœ í™•ì¸, ì‹¬ì‚¬ ëŒ€ê¸° ì¤‘ì´ë©´ ìŠ¹ì¸ í›„ ì¬ì‹œë„

âŒ "ë°œì‹  í”„ë¡œí•„ í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ"
ì›ì¸: Sender Key ì˜¤íƒ€ ë˜ëŠ” ë§Œë£Œ
í•´ê²°: ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ > ê´€ë¦¬ > ë°œì‹  í”„ë¡œí•„ì—ì„œ Sender Key ì¬í™•ì¸

âŒ "ì¹œêµ¬ ì¶”ê°€í•˜ì§€ ì•Šì€ ì‚¬ìš©ì"
ì›ì¸: ì¹œêµ¬í†¡/ë¸Œëœë“œëŠ” ì±„ë„ ì¹œêµ¬ë§Œ ê°€ëŠ¥
í•´ê²°: ìˆ˜ì‹ ìì—ê²Œ ì±„ë„ ì¹œêµ¬ ì¶”ê°€ ìš”ì²­ ë˜ëŠ” ì•Œë¦¼í†¡ ì‚¬ìš©

âŒ "ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨"
ì›ì¸: íŒŒì¼ í¬ê¸° ë˜ëŠ” í˜•ì‹ ë¬¸ì œ
í•´ê²°: 500KB ì´í•˜, JPG/PNG í˜•ì‹ í™•ì¸

âŒ "ë³€ìˆ˜ ì¹˜í™˜ ì‹¤íŒ¨"
ì›ì¸: í…œí”Œë¦¿ê³¼ ë³€ìˆ˜ëª… ë¶ˆì¼ì¹˜
í•´ê²°: í…œí”Œë¦¿ì˜ #{ë³€ìˆ˜ëª…}ê³¼ ì „ë‹¬í•˜ëŠ” ë³€ìˆ˜ëª… ì¼ì¹˜ í™•ì¸


9.2 ë””ë²„ê¹… íŒ
-------------
1. ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ > ë©”ì‹œì§€ > ë°œì†¡ ë‚´ì—­ì—ì„œ ì‹¤íŒ¨ ì‚¬ìœ  í™•ì¸
2. ë°œì†¡ ë¡œê·¸ í…Œì´ë¸”ì—ì„œ error_message í™•ì¸
3. ì¹´ì¹´ì˜¤ API ì‘ë‹µ ì½”ë“œ ì°¸ê³ :
   - 0: ì„±ê³µ
   - -1: ì‹œìŠ¤í…œ ì˜¤ë¥˜
   - -2: íŒŒë¼ë¯¸í„° ì˜¤ë¥˜
   - -401: ì¸ì¦ ì‹¤íŒ¨


9.3 ì„±ëŠ¥ ìµœì í™”
--------------
- ëŒ€ëŸ‰ ë°œì†¡ ì‹œ ë°°ì¹˜ ì²˜ë¦¬ (100ëª…ì”©)
- API í˜¸ì¶œ ì œí•œ ì¤€ìˆ˜ (ì´ˆë‹¹ ìµœëŒ€ 100ê±´)
- DB ì¿¼ë¦¬ ì¸ë±ìŠ¤ í™œìš©
- ì´ë¯¸ì§€ëŠ” CDN ì‚¬ìš© ê¶Œì¥


================================================================================
ì²´í¬ë¦¬ìŠ¤íŠ¸
================================================================================

êµ¬í˜„ ì „:
--------
[ ] ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì • ìƒì„± ì™„ë£Œ
[ ] ì¹´ì¹´ì˜¤í†¡ ì±„ë„ ê°œì„¤ ì™„ë£Œ
[ ] ë°œì‹  í”„ë¡œí•„ ì‹¬ì‚¬ ìŠ¹ì¸ ì™„ë£Œ
[ ] Sender Key í™•ë³´
[ ] ì•Œë¦¼í†¡ í…œí”Œë¦¿ ìµœì†Œ 1ê°œ ìŠ¹ì¸ ì™„ë£Œ
[ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ

êµ¬í˜„ ì¤‘:
--------
[ ] DB í…Œì´ë¸” 4ê°œ ìƒì„±
[ ] ì±„ë„ ê´€ë¦¬ API 3ê°œ êµ¬í˜„
[ ] ê·¸ë£¹ ê´€ë¦¬ API 3ê°œ êµ¬í˜„
[ ] í…œí”Œë¦¿ ê´€ë¦¬ API 4ê°œ êµ¬í˜„
[ ] ì•Œë¦¼í†¡ ë°œì†¡ API êµ¬í˜„
[ ] ì¹œêµ¬í†¡ ë°œì†¡ API êµ¬í˜„
[ ] ë¸Œëœë“œ ë©”ì‹œì§€ ë°œì†¡ API êµ¬í˜„
[ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ API êµ¬í˜„
[ ] UI ì—°ë™ (7ê°œ ì»´í¬ë„ŒíŠ¸)

êµ¬í˜„ í›„:
--------
[ ] ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ í†µê³¼
[ ] ë°œì†¡ ë¡œê·¸ ì •ìƒ ì €ì¥ í™•ì¸
[ ] ëŒ€ì²´ë°œì†¡ ë™ì‘ í™•ì¸
[ ] ì—ëŸ¬ ì²˜ë¦¬ ê²€ì¦
[ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
[ ] ë¬¸ì„œí™”


================================================================================
ë¬¸ì„œ ë
================================================================================

â±ï¸ ì˜ˆìƒ êµ¬í˜„ ê¸°ê°„: 4ì£¼
ğŸ’° ì˜ˆìƒ ë¹„ìš©: ì•Œë¦¼í†¡ 15ì›/ê±´, ì¹œêµ¬í†¡ 18ì›/ê±´, ë¸Œëœë“œ 25ì›/ê±´
ğŸ“Œ ë‚œì´ë„: â­â­â­â­ (ë†’ìŒ)

================================================================================
